<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestión Laboral MEP 4.0</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/quill@2.0.0/dist/quill.snow.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/main.min.css">
    <style>
        /* ===== VARIABLES Y RESET ===== */
        :root {
            /* Colores institucionales MEP */
            --mep-blue: #0056A6;
            --mep-blue-light: #1a7fcc;
            --mep-green: #28A745;
            --mep-orange: #FD7E14;
            --mep-yellow: #FFC107;
            --mep-red: #DC3545;
            --mep-purple: #6F42C1;
            --mep-teal: #20C997;
            
            /* Tema claro (predeterminado) */
            --bg-primary: #f8f9fa;
            --bg-secondary: #ffffff;
            --bg-sidebar: #1e293b;
            --bg-card: #ffffff;
            --bg-hover: #f1f5f9;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-light: #94a3b8;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            
            /* Espaciado */
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --space-2xl: 48px;
            
            /* Bordes redondeados */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --radius-full: 9999px;
            
            /* Transiciones */
            --transition-fast: 150ms ease;
            --transition-normal: 300ms ease;
            --transition-slow: 500ms ease;
        }

        /* Tema oscuro */
        [data-theme="dark"] {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-sidebar: #0f172a;
            --bg-card: #1e293b;
            --bg-hover: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-light: #64748b;
            --border-color: #334155;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.5;
            overflow-x: hidden;
            transition: background-color var(--transition-normal);
        }

        /* ===== LAYOUT PRINCIPAL ===== */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--bg-sidebar);
            color: white;
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 1000;
            transition: transform var(--transition-normal);
            box-shadow: var(--shadow-lg);
        }

        .sidebar-header {
            padding: var(--space-lg);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .logo {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--mep-blue), var(--mep-blue-light));
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 24px;
        }

        .logo-text {
            font-size: 20px;
            font-weight: 700;
        }

        .logo-subtext {
            font-size: 12px;
            opacity: 0.8;
        }

        .nav-menu {
            flex: 1;
            padding: var(--space-md) 0;
            overflow-y: auto;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md) var(--space-lg);
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: all var(--transition-fast);
            cursor: pointer;
            border-left: 4px solid transparent;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .nav-item.active {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border-left-color: var(--mep-blue-light);
        }

        .nav-icon {
            font-size: 18px;
            width: 24px;
            text-align: center;
        }

        .nav-text {
            font-size: 14px;
            font-weight: 500;
            flex: 1;
        }

        .badge {
            background: var(--mep-red);
            color: white;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: var(--radius-full);
            font-weight: 600;
        }

        .sidebar-footer {
            padding: var(--space-lg);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 12px;
            opacity: 0.7;
        }

        /* Contenido principal */
        .main-content {
            flex: 1;
            margin-left: 280px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: margin-left var(--transition-normal);
        }

        /* Header superior */
        .top-header {
            background: var(--bg-secondary);
            padding: var(--space-md) var(--space-xl);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 500;
            border-bottom: 1px solid var(--border-color);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 20px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
        }

        .menu-toggle:hover {
            background: var(--bg-hover);
        }

        .page-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: var(--space-lg);
        }

        .live-clock {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .time {
            font-size: 20px;
            font-weight: 700;
            color: var(--mep-blue);
            font-family: 'Courier New', monospace;
        }

        .greeting {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm) var(--space-md);
            background: var(--bg-primary);
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: all var(--transition-fast);
            border: 1px solid var(--border-color);
        }

        .user-profile:hover {
            background: var(--bg-hover);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--mep-blue), var(--mep-blue-light));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-size: 14px;
            font-weight: 600;
        }

        .user-role {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Área de contenido */
        .content-area {
            flex: 1;
            padding: var(--space-xl);
            overflow-y: auto;
            background: var(--bg-primary);
        }

        /* ===== COMPONENTES COMUNES ===== */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
            text-decoration: none;
        }

        .btn-primary {
            background: var(--mep-blue);
            color: white;
        }

        .btn-primary:hover {
            background: var(--mep-blue-light);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--bg-hover);
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--mep-green);
            color: white;
        }

        .btn-danger {
            background: var(--mep-red);
            color: white;
        }

        .btn-warning {
            background: var(--mep-yellow);
            color: var(--text-primary);
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        .btn-icon {
            width: 36px;
            height: 36px;
            padding: 0;
            justify-content: center;
        }

        .card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            transition: all var(--transition-normal);
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: var(--space-lg);
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .section-subtitle {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: var(--space-md);
            color: var(--text-secondary);
        }

        .form-group {
            margin-bottom: var(--space-lg);
        }

        .form-label {
            display: block;
            margin-bottom: var(--space-sm);
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 14px;
            background: var(--bg-card);
            color: var(--text-primary);
            transition: all var(--transition-fast);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--mep-blue);
            box-shadow: 0 0 0 3px rgba(0, 86, 166, 0.1);
        }

        .form-select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 14px;
            background: var(--bg-card);
            color: var(--text-primary);
            cursor: pointer;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-md);
        }

        .empty-state {
            padding: var(--space-2xl);
            text-align: center;
            color: var(--text-secondary);
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            border: 2px dashed var(--border-color);
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: var(--space-md);
            opacity: 0.5;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-2xl);
            color: var(--text-secondary);
        }

        .loading::after {
            content: '';
            width: 24px;
            height: 24px;
            border: 3px solid var(--border-color);
            border-top-color: var(--mep-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: var(--space-md);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ===== DASHBOARD ===== */
        .dashboard {
            display: grid;
            gap: var(--space-xl);
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
            flex-wrap: wrap;
            gap: var(--space-md);
        }

        .quick-actions {
            display: flex;
            gap: var(--space-md);
            flex-wrap: wrap;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--space-lg);
        }

        .stat-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: var(--shadow-md);
            transition: all var(--transition-normal);
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
        }

        .stat-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .stat-icon.tasks { background: rgba(220, 53, 69, 0.1); color: var(--mep-red); }
        .stat-icon.time { background: rgba(32, 201, 151, 0.1); color: var(--mep-teal); }
        .stat-icon.meetings { background: rgba(111, 66, 193, 0.1); color: var(--mep-purple); }
        .stat-icon.links { background: rgba(255, 193, 7, 0.1); color: var(--mep-yellow); }
        .stat-icon.reports { background: rgba(0, 86, 166, 0.1); color: var(--mep-blue); }

        .stat-value {
            font-size: 32px;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: var(--space-xs);
        }

        .stat-change {
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }

        .stat-change.positive { color: var(--mep-green); }
        .stat-change.negative { color: var(--mep-red); }

        .progress-bar {
            height: 8px;
            background: var(--border-color);
            border-radius: var(--radius-full);
            overflow: hidden;
            margin-top: var(--space-md);
        }

        .progress-fill {
            height: 100%;
            border-radius: var(--radius-full);
            transition: width var(--transition-normal);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: var(--space-xl);
        }

        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        .activity-list, .event-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }

        .activity-item, .event-item {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md);
            background: var(--bg-primary);
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
            border: 1px solid var(--border-color);
        }

        .activity-item:hover, .event-item:hover {
            background: var(--bg-hover);
            border-color: var(--mep-blue-light);
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }

        .activity-content {
            flex: 1;
            min-width: 0;
        }

        .activity-title {
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        .activity-time {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }

        /* ===== BITÁCORA ONE-NOTE ===== */
        .bitacora-container {
            display: flex;
            flex-direction: column;
            gap: var(--space-xl);
        }

        .bitacora-tabs {
            display: flex;
            border-bottom: 2px solid var(--border-color);
            gap: var(--space-sm);
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: var(--space-md) var(--space-lg);
            background: none;
            border: none;
            font-size: 15px;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
            border-radius: var(--radius-md) var(--radius-md) 0 0;
        }

        .tab-btn:hover {
            color: var(--text-primary);
            background: var(--bg-hover);
        }

        .tab-btn.active {
            color: var(--mep-blue);
            background: var(--bg-card);
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--mep-blue);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Editor OneNote */
        .onenote-editor {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .editor-toolbar {
            padding: var(--space-md);
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-sm);
        }

        .editor-toolbar button {
            width: 36px;
            height: 36px;
            border: 1px solid var(--border-color);
            background: var(--bg-card);
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .editor-toolbar button:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
            border-color: var(--mep-blue-light);
        }

        .editor-toolbar button.active {
            background: var(--mep-blue);
            color: white;
            border-color: var(--mep-blue);
        }

        .editor-content {
            min-height: 400px;
            padding: var(--space-xl);
            font-size: 16px;
            line-height: 1.6;
        }

        .editor-content:focus {
            outline: none;
        }

        .template-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
        }

        .template-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-fast);
            border: 2px solid var(--border-color);
        }

        .template-card:hover {
            border-color: var(--mep-blue);
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }

        .template-icon {
            font-size: 32px;
            margin-bottom: var(--space-md);
            color: var(--mep-blue);
        }

        .template-title {
            font-weight: 600;
            margin-bottom: var(--space-sm);
        }

        .template-desc {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* ===== CALENDARIO GOOGLE-LIKE ===== */
        .calendar-container {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            overflow: hidden;
        }

        .calendar-header {
            padding: var(--space-lg);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--space-md);
            background: var(--bg-primary);
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .calendar-view-toggle {
            display: flex;
            background: var(--bg-primary);
            border-radius: var(--radius-md);
            padding: 4px;
            border: 1px solid var(--border-color);
        }

        .view-btn {
            padding: 8px 16px;
            border: none;
            background: none;
            border-radius: var(--radius-sm);
            font-weight: 600;
            font-size: 14px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .view-btn:hover {
            background: var(--bg-hover);
        }

        .view-btn.active {
            background: var(--mep-blue);
            color: white;
        }

        .current-date {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }

        #calendar {
            padding: var(--space-lg);
            min-height: 600px;
        }

        .fc {
            --fc-border-color: var(--border-color);
            --fc-button-bg-color: var(--mep-blue);
            --fc-button-border-color: var(--mep-blue);
            --fc-button-hover-bg-color: var(--mep-blue-light);
            --fc-button-hover-border-color: var(--mep-blue-light);
            --fc-button-active-bg-color: var(--mep-blue-light);
            --fc-button-active-border-color: var(--mep-blue-light);
            --fc-today-bg-color: rgba(0, 86, 166, 0.05);
            --fc-page-bg-color: var(--bg-card);
            --fc-neutral-bg-color: var(--bg-primary);
            --fc-list-event-hover-bg-color: var(--bg-hover);
        }

        .fc-theme-standard td, .fc-theme-standard th {
            border-color: var(--border-color);
        }

        .fc-daygrid-day {
            background: var(--bg-card);
        }

        .fc-daygrid-day.fc-day-today {
            background: rgba(0, 86, 166, 0.05);
        }

        /* ===== TAREAS ===== */
        .tasks-container {
            display: flex;
            flex-direction: column;
            gap: var(--space-xl);
        }

        .tasks-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--space-md);
        }

        .filters {
            display: flex;
            gap: var(--space-sm);
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            background: var(--bg-card);
            border-radius: var(--radius-md);
            font-size: 14px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .filter-btn:hover {
            background: var(--bg-hover);
            border-color: var(--mep-blue-light);
        }

        .filter-btn.active {
            background: var(--mep-blue);
            color: white;
            border-color: var(--mep-blue);
        }

        .tasks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: var(--space-lg);
        }

        .task-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: var(--shadow-md);
            border-top: 4px solid var(--border-color);
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .task-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .task-card.high { border-color: var(--mep-red); }
        .task-card.medium { border-color: var(--mep-yellow); }
        .task-card.low { border-color: var(--mep-green); }
        .task-card.completed { border-color: var(--mep-teal); }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-md);
            gap: var(--space-md);
        }

        .task-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text-primary);
            flex: 1;
        }

        .task-priority {
            display: inline-block;
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
        }

        .priority-high { background: rgba(220, 53, 69, 0.1); color: var(--mep-red); }
        .priority-medium { background: rgba(255, 193, 7, 0.1); color: var(--mep-yellow); }
        .priority-low { background: rgba(40, 167, 69, 0.1); color: var(--mep-green); }

        .task-due {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: var(--space-md);
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }

        .task-due.overdue {
            color: var(--mep-red);
            font-weight: 600;
        }

        .task-description {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: var(--space-lg);
            line-height: 1.6;
            max-height: 80px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
        }

        .task-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: var(--space-md);
            border-top: 1px solid var(--border-color);
        }

        .task-status {
            padding: 6px 12px;
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 600;
            background: var(--bg-primary);
            color: var(--text-secondary);
        }

        .status-pending { background: rgba(108, 117, 125, 0.1); color: var(--text-secondary); }
        .status-inprogress { background: rgba(0, 86, 166, 0.1); color: var(--mep-blue); }
        .status-completed { background: rgba(40, 167, 69, 0.1); color: var(--mep-green); }

        .task-actions {
            display: flex;
            gap: var(--space-xs);
        }

        .action-btn {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
            background: var(--bg-card);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .action-btn:hover {
            background: var(--mep-blue);
            color: white;
            border-color: var(--mep-blue);
            transform: scale(1.1);
        }

        .action-btn.delete:hover {
            background: var(--mep-red);
            border-color: var(--mep-red);
        }

        /* ===== ASISTENTE IA ===== */
        .assistant-container {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: var(--space-xl);
            height: 70vh;
            min-height: 600px;
        }

        @media (max-width: 1024px) {
            .assistant-container {
                grid-template-columns: 1fr;
                height: auto;
            }
        }

        .chat-container {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            padding: var(--space-lg);
            background: linear-gradient(135deg, var(--mep-blue), var(--mep-blue-light));
            color: white;
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        }

        .assistant-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .assistant-subtitle {
            font-size: 14px;
            opacity: 0.9;
        }

        .ai-engine-selector {
            display: flex;
            gap: var(--space-xs);
            margin-top: var(--space-md);
        }

        .engine-btn {
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-sm);
            color: white;
            font-size: 12px;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .engine-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .engine-btn.active {
            background: white;
            color: var(--mep-blue);
            font-weight: 600;
        }

        .chat-messages {
            flex: 1;
            padding: var(--space-lg);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
            background: var(--bg-primary);
        }

        .message {
            max-width: 80%;
            padding: var(--space-md);
            border-radius: var(--radius-lg);
            line-height: 1.6;
            animation: messageAppear 0.3s ease;
        }

        @keyframes messageAppear {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            background: var(--mep-blue);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }

        .message.assistant {
            background: var(--bg-card);
            color: var(--text-primary);
            align-self: flex-start;
            border-bottom-left-radius: 4px;
            border: 1px solid var(--border-color);
        }

        .message.thinking {
            background: var(--bg-primary);
            color: var(--text-secondary);
            font-style: italic;
        }

        .chat-input-container {
            padding: var(--space-lg);
            border-top: 1px solid var(--border-color);
            background: var(--bg-card);
        }

        .chat-input-form {
            display: flex;
            gap: var(--space-md);
        }

        .chat-input {
            flex: 1;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
            resize: none;
            min-height: 44px;
            max-height: 120px;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--mep-blue);
            box-shadow: 0 0 0 3px rgba(0, 86, 166, 0.1);
        }

        .quick-commands {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
        }

        .command-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
            flex: 1;
        }

        .command-btn {
            padding: var(--space-md);
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            text-align: left;
            cursor: pointer;
            transition: all var(--transition-fast);
            color: var(--text-primary);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .command-btn:hover {
            background: var(--mep-blue);
            color: white;
            border-color: var(--mep-blue);
            transform: translateX(4px);
        }

        .command-btn i {
            font-size: 16px;
        }

        /* ===== ENLACES AVANZADOS ===== */
        .links-container {
            display: flex;
            flex-direction: column;
            gap: var(--space-xl);
        }

        .links-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--space-md);
        }

        .add-link-form {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: var(--shadow-md);
            display: flex;
            gap: var(--space-md);
            flex-wrap: wrap;
        }

        .link-input-group {
            flex: 1;
            min-width: 300px;
        }

        .links-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--space-lg);
        }

        .link-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: var(--shadow-md);
            display: flex;
            flex-direction: column;
            transition: all var(--transition-normal);
            text-decoration: none;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .link-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
            border-color: var(--mep-blue-light);
        }

        .link-favicon {
            width: 56px;
            height: 56px;
            background: var(--bg-primary);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            margin-bottom: var(--space-md);
            color: var(--mep-blue);
        }

        .link-title {
            font-weight: 600;
            margin-bottom: var(--space-sm);
            font-size: 16px;
            line-height: 1.4;
        }

        .link-url {
            font-size: 13px;
            color: var(--text-secondary);
            word-break: break-all;
            margin-bottom: var(--space-md);
        }

        .link-qr {
            position: absolute;
            top: var(--space-lg);
            right: var(--space-lg);
            width: 48px;
            height: 48px;
            background: var(--bg-primary);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            font-size: 20px;
        }

        .link-actions {
            display: flex;
            gap: var(--space-xs);
            margin-top: auto;
        }

        /* ===== INTEGRACIONES ===== */
        .integrations-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-xl);
        }

        .integration-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
            transition: all var(--transition-normal);
        }

        .integration-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .integration-header {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .integration-icon {
            width: 56px;
            height: 56px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: white;
        }

        .integration-icon.youtube { background: #FF0000; }
        .integration-icon.mep-mail { background: #0078D4; }
        .integration-icon.symbaloo { background: #00AFF0; }
        .integration-icon.zoom { background: #2D8CFF; }

        .integration-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .integration-status {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .integration-status.connected {
            color: var(--mep-green);
        }

        .integration-actions {
            display: flex;
            gap: var(--space-sm);
            margin-top: auto;
        }

        /* YouTube Player */
        .youtube-player {
            width: 100%;
            height: 200px;
            background: var(--bg-primary);
            border-radius: var(--radius-md);
            overflow: hidden;
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
        }

        /* ===== INFORMES ===== */
        .reports-container {
            display: flex;
            flex-direction: column;
            gap: var(--space-xl);
        }

        .period-selector {
            display: flex;
            gap: var(--space-md);
            flex-wrap: wrap;
            background: var(--bg-card);
            padding: var(--space-md);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
        }

        .period-btn {
            padding: 10px 20px;
            border: 1px solid var(--border-color);
            background: var(--bg-primary);
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-weight: 600;
        }

        .period-btn:hover {
            background: var(--bg-hover);
            border-color: var(--mep-blue-light);
        }

        .period-btn.active {
            background: var(--mep-blue);
            color: white;
            border-color: var(--mep-blue);
        }

        .report-content {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
        }

        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-xl);
            flex-wrap: wrap;
            gap: var(--space-md);
        }

        .report-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .report-period {
            font-size: 16px;
            color: var(--text-secondary);
            background: var(--bg-primary);
            padding: 8px 16px;
            border-radius: var(--radius-full);
        }

        .report-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-lg);
            margin-bottom: var(--space-xl);
        }

        .report-stat {
            text-align: center;
            padding: var(--space-lg);
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            transition: all var(--transition-fast);
        }

        .report-stat:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
            border-color: var(--mep-blue-light);
        }

        .report-value {
            font-size: 32px;
            font-weight: 800;
            color: var(--mep-blue);
            margin-bottom: var(--space-sm);
        }

        .report-label {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .export-options {
            display: flex;
            gap: var(--space-md);
            flex-wrap: wrap;
        }

        .export-btn {
            padding: 12px 24px;
            border: 1px solid var(--border-color);
            background: var(--bg-card);
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .export-btn.pdf { border-color: var(--mep-red); color: var(--mep-red); }
        .export-btn.word { border-color: var(--mep-blue); color: var(--mep-blue); }
        .export-btn.excel { border-color: var(--mep-green); color: var(--mep-green); }
        .export-btn.html { border-color: var(--mep-purple); color: var(--mep-purple); }

        /* ===== CONFIGURACIÓN ===== */
        .settings-container {
            display: flex;
            flex-direction: column;
            gap: var(--space-xl);
        }

        .settings-section {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-xl);
        }

        .setting-item {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border-color);
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--mep-blue);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .backup-section {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }

        .backup-options {
            display: flex;
            gap: var(--space-md);
            flex-wrap: wrap;
        }

        /* ===== MODALES ===== */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            animation: slideUp 0.3s ease;
            border: 1px solid var(--border-color);
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            padding: var(--space-lg);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-primary);
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .modal-close {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-md);
            border: none;
            background: var(--bg-primary);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .modal-close:hover {
            background: var(--mep-red);
            color: white;
        }

        .modal-body {
            padding: var(--space-lg);
            max-height: 60vh;
            overflow-y: auto;
        }

        .modal-footer {
            padding: var(--space-lg);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: var(--space-md);
            background: var(--bg-primary);
            border-radius: 0 0 var(--radius-lg) var(--radius-lg);
        }

        /* ===== NOTIFICACIONES ===== */
        .notification-container {
            position: fixed;
            bottom: var(--space-xl);
            right: var(--space-xl);
            z-index: 3000;
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
            max-width: 400px;
        }

        .notification {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: var(--space-md) var(--space-lg);
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            gap: var(--space-md);
            animation: slideInRight 0.3s ease;
            border-left: 4px solid var(--mep-blue);
            transform: translateX(0);
            transition: transform 0.3s ease, opacity 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .notification.hiding {
            transform: translateX(100%);
            opacity: 0;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            background: rgba(0, 86, 166, 0.1);
            color: var(--mep-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .notification.success .notification-icon {
            background: rgba(40, 167, 69, 0.1);
            color: var(--mep-green);
        }

        .notification.error .notification-icon {
            background: rgba(220, 53, 69, 0.1);
            color: var(--mep-red);
        }

        .notification.warning .notification-icon {
            background: rgba(255, 193, 7, 0.1);
            color: var(--mep-yellow);
        }

        .notification-content {
            flex: 1;
            min-width: 0;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .notification-message {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .notification-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 18px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-sm);
            transition: all var(--transition-fast);
        }

        .notification-close:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1200px) {
            .main-content {
                margin-left: 0;
            }
            
            .sidebar {
                transform: translateX(-100%);
                z-index: 2000;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .menu-toggle {
                display: block;
            }
            
            .header-right {
                display: none;
            }
            
            .header-right.active {
                display: flex;
                position: fixed;
                top: 80px;
                right: var(--space-md);
                background: var(--bg-card);
                border-radius: var(--radius-lg);
                padding: var(--space-md);
                box-shadow: var(--shadow-xl);
                border: 1px solid var(--border-color);
                z-index: 1000;
                flex-direction: column;
                min-width: 250px;
            }
        }

        @media (max-width: 768px) {
            .content-area {
                padding: var(--space-md);
            }
            
            .dashboard-title {
                font-size: 20px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                flex-direction: column;
                width: 100%;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .add-link-form {
                flex-direction: column;
            }
            
            .link-input-group {
                min-width: 100%;
            }
            
            .notification-container {
                left: var(--space-md);
                right: var(--space-md);
                max-width: none;
            }
            
            .assistant-container {
                height: auto;
                min-height: 400px;
            }
            
            .chat-input-form {
                flex-direction: column;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .tasks-grid {
                grid-template-columns: 1fr;
            }
            
            .links-grid {
                grid-template-columns: 1fr;
            }
            
            .period-selector {
                flex-direction: column;
            }
            
            .period-btn {
                width: 100%;
                text-align: center;
            }
            
            .export-options {
                flex-direction: column;
            }
            
            .export-btn {
                width: 100%;
                justify-content: center;
            }
            
            .modal {
                width: 95%;
                margin: var(--space-md);
            }
        }

        /* ===== UTILIDADES ===== */
        .hidden {
            display: none !important;
        }

        .visible {
            display: block !important;
        }

        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-1 { gap: var(--space-sm); }
        .gap-2 { gap: var(--space-md); }
        .gap-3 { gap: var(--space-lg); }
        .gap-4 { gap: var(--space-xl); }

        .w-full { width: 100%; }
        .h-full { height: 100%; }

        .text-center { text-align: center; }
        .text-right { text-align: right; }

        .mb-1 { margin-bottom: var(--space-sm); }
        .mb-2 { margin-bottom: var(--space-md); }
        .mb-3 { margin-bottom: var(--space-lg); }
        .mb-4 { margin-bottom: var(--space-xl); }

        .mt-1 { margin-top: var(--space-sm); }
        .mt-2 { margin-top: var(--space-md); }
        .mt-3 { margin-top: var(--space-lg); }
        .mt-4 { margin-top: var(--space-xl); }

        .p-1 { padding: var(--space-sm); }
        .p-2 { padding: var(--space-md); }
        .p-3 { padding: var(--space-lg); }
        .p-4 { padding: var(--space-xl); }

        .rounded { border-radius: var(--radius-md); }
        .rounded-lg { border-radius: var(--radius-lg); }
        .rounded-full { border-radius: var(--radius-full); }

        .shadow { box-shadow: var(--shadow-md); }
        .shadow-lg { box-shadow: var(--shadow-lg); }

        .text-primary { color: var(--text-primary); }
        .text-secondary { color: var(--text-secondary); }
        .text-success { color: var(--mep-green); }
        .text-danger { color: var(--mep-red); }
        .text-warning { color: var(--mep-yellow); }
        .text-info { color: var(--mep-blue); }

        .bg-primary { background: var(--bg-primary); }
        .bg-secondary { background: var(--bg-secondary); }
        .bg-card { background: var(--bg-card); }
        .bg-hover { background: var(--bg-hover); }

        .border { border: 1px solid var(--border-color); }
        .border-b { border-bottom: 1px solid var(--border-color); }
        .border-t { border-top: 1px solid var(--border-color); }

        .cursor-pointer { cursor: pointer; }
        .select-none { user-select: none; }

        .truncate {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .line-clamp-2 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .line-clamp-3 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
        }

        .scrollbar-thin {
            scrollbar-width: thin;
            scrollbar-color: var(--border-color) transparent;
        }

        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        .scrollbar-thin::-webkit-scrollbar-track {
            background: transparent;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb {
            background-color: var(--border-color);
            border-radius: var(--radius-full);
        }

        /* Animaciones adicionales */
        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .shake {
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .fade-in {
            animation: fadeIn 0.3s ease;
        }

        .slide-in-up {
            animation: slideUp 0.3s ease;
        }

        .slide-in-right {
            animation: slideInRight 0.3s ease;
        }

        /* Estados de carga */
        .skeleton {
            background: linear-gradient(90deg, var(--bg-hover) 25%, var(--bg-primary) 50%, var(--bg-hover) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: var(--radius-md);
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
</head>
<body>
    <!-- Contenedor principal -->
    <div class="app-container">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">MEP</div>
                <div>
                    <div class="logo-text">Gestión Laboral 4.0</div>
                    <div class="logo-subtext">Asesor Nacional DRTE</div>
                </div>
            </div>
            
            <div class="nav-menu scrollbar-thin">
                <a href="#" class="nav-item active" data-page="dashboard">
                    <i class="nav-icon fas fa-home"></i>
                    <span class="nav-text">Dashboard</span>
                    <span class="badge" id="dashboardBadge">3</span>
                </a>
                <a href="#" class="nav-item" data-page="calendar">
                    <i class="nav-icon fas fa-calendar-alt"></i>
                    <span class="nav-text">Calendario</span>
                </a>
                <a href="#" class="nav-item" data-page="tasks">
                    <i class="nav-icon fas fa-tasks"></i>
                    <span class="nav-text">Tareas</span>
                    <span class="badge" id="tasksBadge">5</span>
                </a>
                <a href="#" class="nav-item" data-page="bitacora">
                    <i class="nav-icon fas fa-book"></i>
                    <span class="nav-text">Bitácora OneNote</span>
                    <span class="badge" id="bitacoraBadge">2</span>
                </a>
                <a href="#" class="nav-item" data-page="reports">
                    <i class="nav-icon fas fa-chart-bar"></i>
                    <span class="nav-text">Informes</span>
                </a>
                <a href="#" class="nav-item" data-page="links">
                    <i class="nav-icon fas fa-link"></i>
                    <span class="nav-text">Enlaces</span>
                    <span class="badge" id="linksBadge">8</span>
                </a>
                <a href="#" class="nav-item" data-page="integrations">
                    <i class="nav-icon fas fa-plug"></i>
                    <span class="nav-text">Integraciones</span>
                </a>
                <a href="#" class="nav-item" data-page="assistant">
                    <i class="nav-icon fas fa-robot"></i>
                    <span class="nav-text">Asistente IA</span>
                    <span class="badge pulse">Nuevo</span>
                </a>
                <a href="#" class="nav-item" data-page="settings">
                    <i class="nav-icon fas fa-cog"></i>
                    <span class="nav-text">Configuración</span>
                </a>
            </div>
            
            <div class="sidebar-footer">
                <div>Ministerio de Educación Pública</div>
                <div>Dirección de Recursos Tecnológicos</div>
                <div>Costa Rica • 2024</div>
            </div>
        </nav>

        <!-- Contenido principal -->
        <main class="main-content" id="mainContent">
            <!-- Header superior -->
            <header class="top-header">
                <div class="header-left">
                    <button class="menu-toggle" id="menuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 class="page-title" id="pageTitle">
                        <i class="fas fa-home"></i>
                        <span>Dashboard</span>
                    </h1>
                </div>
                
                <div class="header-right" id="headerRight">
                    <div class="live-clock">
                        <div class="time" id="currentTime">00:00:00</div>
                        <div class="greeting" id="greeting">Buenos días</div>
                    </div>
                    
                    <div class="user-profile" id="userProfile">
                        <div class="user-avatar">AN</div>
                        <div class="user-info">
                            <div class="user-name">Asesor Nacional DRTE</div>
                            <div class="user-role">MEP Costa Rica</div>
                        </div>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
            </header>

            <!-- Área de contenido -->
            <div class="content-area scrollbar-thin" id="contentArea">
                <!-- Dashboard -->
                <div class="dashboard visible" id="dashboardPage">
                    <div class="dashboard-header">
                        <h2 class="dashboard-title">Panel de Control Principal</h2>
                        <div class="quick-actions">
                            <button class="btn btn-primary" id="quickTaskBtn">
                                <i class="fas fa-plus"></i> Nueva Tarea
                            </button>
                            <button class="btn btn-secondary" id="quickEventBtn">
                                <i class="fas fa-calendar-plus"></i> Nuevo Evento
                            </button>
                            <button class="btn btn-success" id="quickReportBtn">
                                <i class="fas fa-file-alt"></i> Informe Rápido
                            </button>
                        </div>
                    </div>

                    <!-- Estadísticas -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-title">Tareas Pendientes</div>
                                <div class="stat-icon tasks">
                                    <i class="fas fa-tasks"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="statPendingTasks">5</div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-up"></i>
                                <span>2 desde ayer</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill tasks" style="width: 65%"></div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-title">Horas Esta Semana</div>
                                <div class="stat-icon time">
                                    <i class="fas fa-clock"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="statWeeklyHours">42.5</div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-up"></i>
                                <span>3.5% más</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill time" style="width: 85%"></div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-title">Próximas Reuniones</div>
                                <div class="stat-icon meetings">
                                    <i class="fas fa-users"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="statUpcomingMeetings">3</div>
                            <div class="stat-change negative">
                                <i class="fas fa-arrow-down"></i>
                                <span>1 menos</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill meetings" style="width: 40%"></div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-title">Informes Pendientes</div>
                                <div class="stat-icon reports">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="statPendingReports">2</div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-up"></i>
                                <span>1 nuevo</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill reports" style="width: 30%"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Grid del dashboard -->
                    <div class="dashboard-grid">
                        <!-- Actividad reciente -->
                        <div class="card">
                            <h3 class="section-title">
                                <i class="fas fa-history"></i>
                                Actividad Reciente
                            </h3>
                            <div class="activity-list" id="recentActivity">
                                <!-- Las actividades se cargan dinámicamente -->
                            </div>
                        </div>

                        <!-- Próximos eventos -->
                        <div class="card">
                            <h3 class="section-title">
                                <i class="fas fa-calendar-day"></i>
                                Próximos Eventos
                            </h3>
                            <div class="event-list" id="upcomingEvents">
                                <!-- Los eventos se cargan dinámicamente -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Calendario -->
                <div class="calendar-container hidden" id="calendarPage">
                    <div class="calendar-header">
                        <div class="calendar-nav">
                            <button class="btn btn-icon btn-secondary" id="prevBtn" title="Anterior">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <h2 class="current-date" id="currentDate">Enero 2024</h2>
                            <button class="btn btn-icon btn-secondary" id="nextBtn" title="Siguiente">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                            <button class="btn btn-secondary" id="todayBtn">
                                <i class="fas fa-calendar-day"></i> Hoy
                            </button>
                        </div>
                        
                        <div class="calendar-view-toggle">
                            <button class="view-btn" data-view="day">Día</button>
                            <button class="view-btn" data-view="week">Semana</button>
                            <button class="view-btn active" data-view="month">Mes</button>
                            <button class="view-btn" data-view="list">Lista</button>
                        </div>
                        
                        <button class="btn btn-primary" id="newCalendarEventBtn">
                            <i class="fas fa-plus"></i> Nuevo Evento
                        </button>
                    </div>

                    <div id="calendar"></div>
                </div>

                <!-- Tareas -->
                <div class="tasks-container hidden" id="tasksPage">
                    <div class="tasks-header">
                        <h2 class="dashboard-title">
                            <i class="fas fa-tasks"></i>
                            Gestión de Tareas
                        </h2>
                        
                        <div class="filters">
                            <button class="filter-btn active" data-filter="all">Todas</button>
                            <button class="filter-btn" data-filter="pending">Pendientes</button>
                            <button class="filter-btn" data-filter="inprogress">En Proceso</button>
                            <button class="filter-btn" data-filter="completed">Completadas</button>
                            <button class="filter-btn" data-filter="high">Alta Prioridad</button>
                            <button class="filter-btn" data-filter="overdue">Vencidas</button>
                        </div>
                        
                        <div class="quick-actions">
                            <button class="btn btn-primary" id="newTaskBtn">
                                <i class="fas fa-plus"></i> Nueva Tarea
                            </button>
                            <button class="btn btn-secondary" id="importTasksBtn">
                                <i class="fas fa-file-import"></i> Importar
                            </button>
                        </div>
                    </div>

                    <div class="tasks-grid" id="tasksGrid">
                        <!-- Las tareas se cargan dinámicamente -->
                    </div>
                </div>

                <!-- Bitácora OneNote -->
                <div class="bitacora-container hidden" id="bitacoraPage">
                    <div class="bitacora-tabs">
                        <button class="tab-btn active" data-tab="onenote">
                            <i class="fas fa-sticky-note"></i> Editor OneNote
                        </button>
                        <button class="tab-btn" data-tab="daily">
                            <i class="fas fa-calendar-day"></i> Diario
                        </button>
                        <button class="tab-btn" data-tab="weekly">
                            <i class="fas fa-calendar-week"></i> Semanal
                        </button>
                        <button class="tab-btn" data-tab="monthly">
                            <i class="fas fa-calendar-alt"></i> Mensual
                        </button>
                    </div>

                    <!-- Editor OneNote -->
                    <div class="tab-content active" id="onenoteTab">
                        <div class="card">
                            <div class="editor-toolbar" id="editorToolbar">
                                <button type="button" data-command="format" data-value="bold" title="Negrita">
                                    <i class="fas fa-bold"></i>
                                </button>
                                <button type="button" data-command="format" data-value="italic" title="Cursiva">
                                    <i class="fas fa-italic"></i>
                                </button>
                                <button type="button" data-command="format" data-value="underline" title="Subrayado">
                                    <i class="fas fa-underline"></i>
                                </button>
                                <div class="separator"></div>
                                <button type="button" data-command="list" data-value="bullet" title="Lista con viñetas">
                                    <i class="fas fa-list-ul"></i>
                                </button>
                                <button type="button" data-command="list" data-value="number" title="Lista numerada">
                                    <i class="fas fa-list-ol"></i>
                                </button>
                                <div class="separator"></div>
                                <button type="button" data-command="heading" data-value="h2" title="Título 2">
                                    <i class="fas fa-heading"></i>2
                                </button>
                                <button type="button" data-command="heading" data-value="h3" title="Título 3">
                                    <i class="fas fa-heading"></i>3
                                </button>
                                <div class="separator"></div>
                                <button type="button" data-command="insert" data-value="table" title="Insertar tabla">
                                    <i class="fas fa-table"></i>
                                </button>
                                <button type="button" data-command="insert" data-value="link" title="Insertar enlace">
                                    <i class="fas fa-link"></i>
                                </button>
                                <button type="button" data-command="insert" data-value="image" title="Insertar imagen">
                                    <i class="fas fa-image"></i>
                                </button>
                                <div class="separator"></div>
                                <button type="button" id="saveNoteBtn" class="btn btn-primary btn-small">
                                    <i class="fas fa-save"></i> Guardar
                                </button>
                                <button type="button" id="clearNoteBtn" class="btn btn-secondary btn-small">
                                    <i class="fas fa-trash"></i> Limpiar
                                </button>
                            </div>
                            <div 
                                class="editor-content" 
                                id="editorContent" 
                                contenteditable="true"
                                data-placeholder="Escribe tu informe aquí... Puedes usar formato, listas, tablas y más. Este editor funciona como Microsoft OneNote."
                            ></div>
                        </div>

                        <!-- Plantillas -->
                        <div class="card mt-4">
                            <h3 class="section-title">
                                <i class="fas fa-layer-group"></i>
                                Plantillas de Informes
                            </h3>
                            <div class="template-selector">
                                <div class="template-card" data-template="daily">
                                    <div class="template-icon">
                                        <i class="fas fa-sun"></i>
                                    </div>
                                    <div class="template-title">Informe Diario</div>
                                    <div class="template-desc">Formato estándar para reportes diarios</div>
                                </div>
                                <div class="template-card" data-template="weekly">
                                    <div class="template-icon">
                                        <i class="fas fa-calendar-week"></i>
                                    </div>
                                    <div class="template-title">Informe Semanal</div>
                                    <div class="template-desc">Resumen de actividades semanales</div>
                                </div>
                                <div class="template-card" data-template="monthly">
                                    <div class="template-icon">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <div class="template-title">Informe Mensual</div>
                                    <div class="template-desc">Reporte completo del mes</div>
                                </div>
                                <div class="template-card" data-template="meeting">
                                    <div class="template-icon">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <div class="template-title">Acta de Reunión</div>
                                    <div class="template-desc">Formato para minutas de reuniones</div>
                                </div>
                            </div>
                        </div>

                        <!-- Notas guardadas -->
                        <div class="card mt-4">
                            <h3 class="section-title">
                                <i class="fas fa-archive"></i>
                                Notas Guardadas
                            </h3>
                            <div class="activity-list" id="savedNotes">
                                <!-- Las notas se cargan dinámicamente -->
                            </div>
                        </div>
                    </div>

                    <!-- Pestaña Diario -->
                    <div class="tab-content" id="dailyTab">
                        <div class="card">
                            <h3 class="section-title">
                                <i class="fas fa-calendar-day"></i>
                                Bitácora Diaria
                            </h3>
                            <!-- Contenido de la bitácora diaria -->
                        </div>
                    </div>

                    <!-- Pestaña Semanal -->
                    <div class="tab-content" id="weeklyTab">
                        <div class="card">
                            <h3 class="section-title">
                                <i class="fas fa-calendar-week"></i>
                                Plan Semanal
                            </h3>
                            <!-- Contenido del plan semanal -->
                        </div>
                    </div>

                    <!-- Pestaña Mensual -->
                    <div class="tab-content" id="monthlyTab">
                        <div class="card">
                            <h3 class="section-title">
                                <i class="fas fa-calendar-alt"></i>
                                Informe Mensual
                            </h3>
                            <!-- Contenido del informe mensual -->
                        </div>
                    </div>
                </div>

                <!-- Informes -->
                <div class="reports-container hidden" id="reportsPage">
                    <div class="dashboard-header">
                        <h2 class="dashboard-title">
                            <i class="fas fa-chart-bar"></i>
                            Sistema de Informes
                        </h2>
                        <div class="quick-actions">
                            <button class="btn btn-primary" id="generateReportBtn">
                                <i class="fas fa-plus"></i> Nuevo Informe
                            </button>
                        </div>
                    </div>

                    <!-- Selector de período -->
                    <div class="period-selector">
                        <button class="period-btn active" data-period="daily">Diario</button>
                        <button class="period-btn" data-period="weekly">Semanal</button>
                        <button class="period-btn" data-period="biweekly">Quincenal</button>
                        <button class="period-btn" data-period="monthly">Mensual</button>
                        <button class="period-btn" data-period="annual">Anual</button>
                    </div>

                    <!-- Contenido del informe -->
                    <div class="report-content">
                        <div class="report-header">
                            <div>
                                <div class="report-title" id="reportTitle">Informe de Actividades</div>
                                <div class="report-period" id="reportPeriod">26 de Enero, 2024</div>
                            </div>
                            <div class="export-options">
                                <button class="export-btn pdf" id="exportPdfBtn">
                                    <i class="fas fa-file-pdf"></i> PDF
                                </button>
                                <button class="export-btn word" id="exportWordBtn">
                                    <i class="fas fa-file-word"></i> Word
                                </button>
                                <button class="export-btn excel" id="exportExcelBtn">
                                    <i class="fas fa-file-excel"></i> Excel
                                </button>
                                <button class="export-btn html" id="exportHtmlBtn">
                                    <i class="fas fa-file-code"></i> HTML
                                </button>
                            </div>
                        </div>

                        <!-- Estadísticas del informe -->
                        <div class="report-stats">
                            <div class="report-stat">
                                <div class="report-value" id="reportHours">42.5</div>
                                <div class="report-label">Horas Trabajadas</div>
                            </div>
                            <div class="report-stat">
                                <div class="report-value" id="reportTasks">8</div>
                                <div class="report-label">Tareas Completadas</div>
                            </div>
                            <div class="report-stat">
                                <div class="report-value" id="reportMeetings">3</div>
                                <div class="report-label">Reuniones</div>
                            </div>
                            <div class="report-stat">
                                <div class="report-value" id="reportProductivity">85%</div>
                                <div class="report-label">Productividad</div>
                            </div>
                        </div>

                        <!-- Detalles del informe -->
                        <div class="card mt-4">
                            <h3 class="section-title">
                                <i class="fas fa-list-check"></i>
                                Detalle de Actividades
                            </h3>
                            <div class="activity-list" id="reportActivities">
                                <!-- Las actividades del informe se cargan dinámicamente -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Enlaces -->
                <div class="links-container hidden" id="linksPage">
                    <div class="links-header">
                        <h2 class="dashboard-title">
                            <i class="fas fa-link"></i>
                            Gestión de Enlaces
                        </h2>
                        <div class="quick-actions">
                            <button class="btn btn-primary" id="newLinkBtn">
                                <i class="fas fa-plus"></i> Nuevo Enlace
                            </button>
                            <button class="btn btn-secondary" id="importLinksBtn">
                                <i class="fas fa-file-import"></i> Importar
                            </button>
                        </div>
                    </div>

                    <!-- Formulario para agregar enlaces -->
                    <div class="add-link-form">
                        <div class="link-input-group">
                            <label class="form-label">URL del Enlace</label>
                            <input type="url" class="form-control" id="linkUrl" placeholder="https://ejemplo.com" required>
                        </div>
                        <div class="link-input-group">
                            <label class="form-label">Título Personalizado</label>
                            <input type="text" class="form-control" id="linkTitle" placeholder="Nombre del enlace">
                        </div>
                        <div class="link-input-group">
                            <label class="form-label">Categoría</label>
                            <select class="form-select" id="linkCategory">
                                <option value="general">General</option>
                                <option value="mep">MEP Oficial</option>
                                <option value="tools">Herramientas</option>
                                <option value="docs">Documentación</option>
                                <option value="meetings">Reuniones</option>
                            </select>
                        </div>
                        <div style="display: flex; align-items: flex-end;">
                            <button class="btn btn-primary" id="addLinkBtn">
                                <i class="fas fa-plus"></i> Agregar
                            </button>
                        </div>
                    </div>

                    <!-- Grid de enlaces -->
                    <div class="links-grid" id="linksGrid">
                        <!-- Los enlaces se cargan dinámicamente -->
                    </div>
                </div>

                <!-- Integraciones -->
                <div class="integrations-container hidden" id="integrationsPage">
                    <div class="dashboard-header">
                        <h2 class="dashboard-title">
                            <i class="fas fa-plug"></i>
                            Integraciones
                        </h2>
                    </div>

                    <!-- YouTube -->
                    <div class="integration-card">
                        <div class="integration-header">
                            <div class="integration-icon youtube">
                                <i class="fab fa-youtube"></i>
                            </div>
                            <div>
                                <div class="integration-title">YouTube</div>
                                <div class="integration-status connected">Conectado</div>
                            </div>
                        </div>
                        <p>Acceso a tutoriales y recursos educativos de YouTube directamente desde el sistema.</p>
                        <div class="youtube-player" id="youtubePlayer">
                            <div class="empty-state" style="padding: var(--space-lg);">
                                <i class="fab fa-youtube"></i>
                                <div>Reproductor de YouTube</div>
                                <small>Busca y reproduce videos educativos</small>
                            </div>
                        </div>
                        <div class="integration-actions">
                            <button class="btn btn-secondary" id="searchYouTubeBtn">
                                <i class="fas fa-search"></i> Buscar Videos
                            </button>
                            <button class="btn btn-primary" id="openYouTubeBtn">
                                <i class="fab fa-youtube"></i> Abrir YouTube
                            </button>
                        </div>
                    </div>

                    <!-- Correo MEP -->
                    <div class="integration-card">
                        <div class="integration-header">
                            <div class="integration-icon mep-mail">
                                <i class="fas fa-envelope"></i>
                            </div>
                            <div>
                                <div class="integration-title">Correo MEP</div>
                                <div class="integration-status connected">Conectado</div>
                            </div>
                        </div>
                        <p>Acceso a tu correo institucional del MEP. Revisa y envía correos directamente.</p>
                        <div class="integration-actions">
                            <button class="btn btn-secondary" id="checkMailBtn">
                                <i class="fas fa-sync"></i> Revisar Correo
                            </button>
                            <button class="btn btn-primary" id="composeMailBtn">
                                <i class="fas fa-edit"></i> Redactar
                            </button>
                        </div>
                    </div>

                    <!-- Symbaloo -->
                    <div class="integration-card">
                        <div class="integration-header">
                            <div class="integration-icon symbaloo">
                                <i class="fas fa-th-large"></i>
                            </div>
                            <div>
                                <div class="integration-title">Symbaloo MEP</div>
                                <div class="integration-status">No conectado</div>
                            </div>
                        </div>
                        <p>Acceso rápido a todos los recursos educativos organizados en Symbaloo.</p>
                        <div class="integration-actions">
                            <button class="btn btn-primary" id="connectSymbalooBtn">
                                <i class="fas fa-plug"></i> Conectar
                            </button>
                            <button class="btn btn-secondary" id="openSymbalooBtn">
                                <i class="fas fa-external-link-alt"></i> Abrir Symbaloo
                            </button>
                        </div>
                    </div>

                    <!-- Otras integraciones -->
                    <div class="integration-card">
                        <div class="integration-header">
                            <div class="integration-icon" style="background: var(--mep-purple);">
                                <i class="fas fa-tools"></i>
                            </div>
                            <div>
                                <div class="integration-title">Otras Herramientas</div>
                                <div class="integration-status">Disponibles</div>
                            </div>
                        </div>
                        <p>Acceso a diversas herramientas y plataformas utilizadas en el MEP.</p>
                        <div class="integration-actions">
                            <button class="btn btn-secondary" id="manageIntegrationsBtn">
                                <i class="fas fa-cog"></i> Gestionar
                            </button>
                            <button class="btn btn-primary" id="addIntegrationBtn">
                                <i class="fas fa-plus"></i> Agregar
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Asistente IA -->
                <div class="assistant-container hidden" id="assistantPage">
                    <div class="chat-container">
                        <div class="chat-header">
                            <div class="assistant-title">
                                <i class="fas fa-robot"></i>
                                Asistente DRTE IA
                            </div>
                            <div class="assistant-subtitle">
                                Asistente virtual con múltiples motores de IA integrados
                            </div>
                            <div class="ai-engine-selector">
                                <button class="engine-btn active" data-engine="deepseek">DeepSeek</button>
                                <button class="engine-btn" data-engine="gemini">Gemini</button>
                                <button class="engine-btn" data-engine="copilot">Copilot</button>
                                <button class="engine-btn" data-engine="chatgpt">ChatGPT</button>
                                <button class="engine-btn" data-engine="local">Local</button>
                            </div>
                        </div>
                        
                        <div class="chat-messages scrollbar-thin" id="chatMessages">
                            <div class="message assistant">
                                ¡Hola! Soy tu asistente virtual del MEP. Estoy equipado con múltiples motores de IA para ayudarte. ¿En qué puedo asistirte hoy? Puedo ayudarte con:
                                <br><br>
                                • 📅 Gestión de tareas y calendario<br>
                                • 📊 Generación de informes<br>
                                • 🔍 Búsqueda de información<br>
                                • 💡 Recomendaciones personalizadas<br>
                                • ✍️ Redacción de documentos
                                <br><br>
                                Selecciona un motor de IA arriba o simplemente pregúntame lo que necesites.
                            </div>
                        </div>
                        
                        <div class="chat-input-container">
                            <form class="chat-input-form" id="chatForm">
                                <textarea 
                                    class="chat-input" 
                                    id="chatInput" 
                                    placeholder="Escribe tu mensaje aquí... Presiona Enter para enviar, Shift+Enter para nueva línea."
                                    rows="1"
                                ></textarea>
                                <button type="submit" class="btn btn-primary btn-icon" id="sendMessageBtn">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </form>
                        </div>
                    </div>

                    <div class="quick-commands">
                        <h3 class="section-title">
                            <i class="fas fa-bolt"></i>
                            Comandos Rápidos
                        </h3>
                        <div class="command-list">
                            <button class="command-btn" data-command="tasks-today">
                                <i class="fas fa-tasks"></i>
                                ¿Qué tareas tengo hoy?
                            </button>
                            <button class="command-btn" data-command="events-week">
                                <i class="fas fa-calendar-week"></i>
                                Eventos de esta semana
                            </button>
                            <button class="command-btn" data-command="generate-report">
                                <i class="fas fa-file-alt"></i>
                                Generar informe semanal
                            </button>
                            <button class="command-btn" data-command="productivity-stats">
                                <i class="fas fa-chart-line"></i>
                                Estadísticas de productividad
                            </button>
                            <button class="command-btn" data-command="help-links">
                                <i class="fas fa-link"></i>
                                Enlaces útiles para el MEP
                            </button>
                            <button class="command-btn" data-command="format-document">
                                <i class="fas fa-file-word"></i>
                                Formatear documento
                            </button>
                            <button class="command-btn" data-command="translate-text">
                                <i class="fas fa-language"></i>
                                Traducir texto
                            </button>
                            <button class="command-btn" data-command="summarize">
                                <i class="fas fa-file-contract"></i>
                                Resumir texto largo
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Configuración -->
                <div class="settings-container hidden" id="settingsPage">
                    <div class="dashboard-header">
                        <h2 class="dashboard-title">
                            <i class="fas fa-cog"></i>
                            Configuración del Sistema
                        </h2>
                    </div>

                    <div class="settings-grid">
                        <!-- Perfil de usuario -->
                        <div class="settings-section">
                            <h3 class="section-title">
                                <i class="fas fa-user"></i>
                                Perfil de Usuario
                            </h3>
                            <div class="setting-item">
                                <label class="form-label">Nombre Completo</label>
                                <input type="text" class="form-control" id="userFullName" value="Asesor Nacional DRTE">
                            </div>
                            <div class="setting-item">
                                <label class="form-label">Correo Institucional</label>
                                <input type="email" class="form-control" id="userEmail" placeholder="usuario@mep.go.cr">
                            </div>
                            <div class="setting-item">
                                <label class="form-label">Departamento</label>
                                <select class="form-select" id="userDepartment">
                                    <option value="drte">DRTE - Dirección de Recursos Tecnológicos</option>
                                    <option value="academico">Académico</option>
                                    <option value="administrativo">Administrativo</option>
                                    <option value="planeamiento">Planeamiento</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <label class="form-label">Rol</label>
                                <input type="text" class="form-control" id="userRole" value="Asesor Nacional" readonly>
                            </div>
                        </div>

                        <!-- Preferencias -->
                        <div class="settings-section">
                            <h3 class="section-title">
                                <i class="fas fa-sliders-h"></i>
                                Preferencias
                            </h3>
                            <div class="setting-item">
                                <label class="form-label">Tema de la Interfaz</label>
                                <select class="form-select" id="themeSelect">
                                    <option value="light">Claro</option>
                                    <option value="dark">Oscuro</option>
                                    <option value="auto">Automático</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <label class="form-label">Idioma</label>
                                <select class="form-select" id="languageSelect">
                                    <option value="es">Español</option>
                                    <option value="en">Inglés</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <label class="form-label">Formato de Fecha</label>
                                <select class="form-select" id="dateFormatSelect">
                                    <option value="dd/mm/yyyy">DD/MM/YYYY</option>
                                    <option value="mm/dd/yyyy">MM/DD/YYYY</option>
                                    <option value="yyyy-mm-dd">YYYY-MM-DD</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <label class="form-label">Zona Horaria</label>
                                <select class="form-select" id="timezoneSelect">
                                    <option value="America/Costa_Rica">Costa Rica (UTC-6)</option>
                                    <option value="UTC">UTC</option>
                                    <option value="America/New_York">EST (UTC-5)</option>
                                </select>
                            </div>
                        </div>

                        <!-- Notificaciones -->
                        <div class="settings-section">
                            <h3 class="section-title">
                                <i class="fas fa-bell"></i>
                                Notificaciones
                            </h3>
                            <div class="setting-item">
                                <label class="form-label">
                                    <input type="checkbox" id="notifyTasks" checked>
                                    <span>Notificaciones de tareas</span>
                                </label>
                                <small class="text-secondary">Recibir alertas sobre tareas pendientes y vencidas</small>
                            </div>
                            <div class="setting-item">
                                <label class="form-label">
                                    <input type="checkbox" id="notifyEvents" checked>
                                    <span>Recordatorios de eventos</span>
                                </label>
                                <small class="text-secondary">Recordatorios antes de reuniones y eventos</small>
                            </div>
                            <div class="setting-item">
                                <label class="form-label">
                                    <input type="checkbox" id="notifyReports">
                                    <span>Notificaciones de informes</span>
                                </label>
                                <small class="text-secondary">Alertas sobre informes pendientes y generados</small>
                            </div>
                            <div class="setting-item">
                                <label class="form-label">
                                    <input type="checkbox" id="emailNotifications" checked>
                                    <span>Notificaciones por correo</span>
                                </label>
                                <small class="text-secondary">Enviar notificaciones importantes al correo</small>
                            </div>
                        </div>

                        <!-- Seguridad y Backup -->
                        <div class="settings-section">
                            <h3 class="section-title">
                                <i class="fas fa-shield-alt"></i>
                                Seguridad y Backup
                            </h3>
                            <div class="backup-section">
                                <div class="setting-item">
                                    <label class="form-label">Frecuencia de Auto-guardado</label>
                                    <select class="form-select" id="autosaveFrequency">
                                        <option value="1">Cada minuto</option>
                                        <option value="5" selected>Cada 5 minutos</option>
                                        <option value="15">Cada 15 minutos</option>
                                        <option value="30">Cada 30 minutos</option>
                                        <option value="60">Cada hora</option>
                                    </select>
                                </div>
                                <div class="backup-options">
                                    <button class="btn btn-secondary" id="exportDataBtn">
                                        <i class="fas fa-download"></i> Exportar Datos
                                    </button>
                                    <button class="btn btn-secondary" id="importDataBtn">
                                        <i class="fas fa-upload"></i> Importar Datos
                                    </button>
                                    <button class="btn btn-primary" id="backupNowBtn">
                                        <i class="fas fa-save"></i> Backup Ahora
                                    </button>
                                </div>
                                <div class="setting-item">
                                    <label class="form-label">
                                        <input type="checkbox" id="encryptData" checked>
                                        <span>Encriptar datos localmente</span>
                                    </label>
                                    <small class="text-secondary">Proteger tus datos con encriptación AES-256</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Acciones de configuración -->
                    <div class="settings-section mt-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="section-title">Acciones del Sistema</h3>
                                <p class="text-secondary">Acciones avanzadas de gestión del sistema</p>
                            </div>
                            <div class="quick-actions">
                                <button class="btn btn-secondary" id="resetSettingsBtn">
                                    <i class="fas fa-undo"></i> Restaurar Valores
                                </button>
                                <button class="btn btn-primary" id="saveSettingsBtn">
                                    <i class="fas fa-save"></i> Guardar Configuración
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal para Tareas -->
    <div class="modal-overlay" id="taskModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="taskModalTitle">Nueva Tarea</h3>
                <button class="modal-close" id="closeTaskModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="taskForm">
                    <div class="form-group">
                        <label class="form-label">Título de la Tarea *</label>
                        <input type="text" class="form-control" id="taskTitle" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Descripción</label>
                        <textarea class="form-control" id="taskDescription" rows="3" placeholder="Describe la tarea en detalle..."></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Prioridad *</label>
                            <select class="form-select" id="taskPriority" required>
                                <option value="high">Alta</option>
                                <option value="medium" selected>Media</option>
                                <option value="low">Baja</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Fecha Límite *</label>
                            <input type="date" class="form-control" id="taskDueDate" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Estado</label>
                            <select class="form-select" id="taskStatus">
                                <option value="pending">Pendiente</option>
                                <option value="inprogress">En Proceso</option>
                                <option value="completed">Completada</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Tiempo Estimado (horas)</label>
                            <input type="number" class="form-control" id="taskEstimatedTime" min="0.5" max="24" step="0.5" value="2">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Categoría</label>
                        <input type="text" class="form-control" id="taskCategory" placeholder="Ej: Administrativo, Docente, Reunión, etc.">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Asignar a</label>
                        <input type="text" class="form-control" id="taskAssignee" placeholder="Nombre del responsable">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelTaskBtn">Cancelar</button>
                <button type="button" class="btn btn-primary" id="saveTaskBtn">Guardar Tarea</button>
            </div>
        </div>
    </div>

    <!-- Modal para Eventos -->
    <div class="modal-overlay" id="eventModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="eventModalTitle">Nuevo Evento</h3>
                <button class="modal-close" id="closeEventModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="eventForm">
                    <div class="form-group">
                        <label class="form-label">Título del Evento *</label>
                        <input type="text" class="form-control" id="eventTitle" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Descripción</label>
                        <textarea class="form-control" id="eventDescription" rows="3" placeholder="Descripción del evento..."></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Tipo de Evento *</label>
                            <select class="form-select" id="eventType" required>
                                <option value="meeting">Reunión</option>
                                <option value="report">Informe</option>
                                <option value="teletrabajo">Teletrabajo</option>
                                <option value="oficina">Oficina</option>
                                <option value="capacitacion">Capacitación</option>
                                <option value="other">Otro</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Color</label>
                            <select class="form-select" id="eventColor" required>
                                <option value="#6F42C1" selected>Morado (Reunión)</option>
                                <option value="#20C997">Verde (Informe)</option>
                                <option value="#28A745">Verde (Teletrabajo)</option>
                                <option value="#0056A6">Azul (Oficina)</option>
                                <option value="#FD7E14">Naranja (Capacitación)</option>
                                <option value="#DC3545">Rojo (Importante)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Fecha de Inicio *</label>
                            <input type="datetime-local" class="form-control" id="eventStart" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Fecha de Fin *</label>
                            <input type="datetime-local" class="form-control" id="eventEnd" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ubicación/Enlace</label>
                        <input type="text" class="form-control" id="eventLocation" placeholder="Sala de reuniones o enlace virtual">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Participantes</label>
                        <input type="text" class="form-control" id="eventParticipants" placeholder="Nombres de participantes separados por coma">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Recordatorio</label>
                        <select class="form-select" id="eventReminder">
                            <option value="0">Sin recordatorio</option>
                            <option value="5">5 minutos antes</option>
                            <option value="15" selected>15 minutos antes</option>
                            <option value="30">30 minutos antes</option>
                            <option value="60">1 hora antes</option>
                            <option value="1440">1 día antes</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelEventBtn">Cancelar</button>
                <button type="button" class="btn btn-primary" id="saveEventBtn">Guardar Evento</button>
            </div>
        </div>
    </div>

    <!-- Modal para Enlaces -->
    <div class="modal-overlay" id="linkModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Nuevo Enlace</h3>
                <button class="modal-close" id="closeLinkModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="linkForm">
                    <div class="form-group">
                        <label class="form-label">URL *</label>
                        <input type="url" class="form-control" id="modalLinkUrl" required placeholder="https://ejemplo.com">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Título</label>
                        <input type="text" class="form-control" id="modalLinkTitle" placeholder="Nombre descriptivo">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Descripción</label>
                        <textarea class="form-control" id="modalLinkDescription" rows="2" placeholder="Descripción del enlace..."></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Categoría</label>
                            <select class="form-select" id="modalLinkCategory">
                                <option value="general">General</option>
                                <option value="mep">MEP Oficial</option>
                                <option value="tools">Herramientas</option>
                                <option value="docs">Documentación</option>
                                <option value="meetings">Reuniones</option>
                                <option value="resources">Recursos</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Etiquetas</label>
                            <input type="text" class="form-control" id="modalLinkTags" placeholder="etiqueta1, etiqueta2, ...">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="modalLinkFavorite">
                            <span>Agregar a favoritos</span>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="modalLinkGenerateQR">
                            <span>Generar código QR</span>
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelLinkBtn">Cancelar</button>
                <button type="button" class="btn btn-primary" id="saveLinkBtn">Guardar Enlace</button>
            </div>
        </div>
    </div>

    <!-- Modal para Informes -->
    <div class="modal-overlay" id="reportModal">
        <div class="modal" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title">Generar Nuevo Informe</h3>
                <button class="modal-close" id="closeReportModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="reportForm">
                    <div class="form-group">
                        <label class="form-label">Tipo de Informe *</label>
                        <select class="form-select" id="reportType" required>
                            <option value="daily">Diario</option>
                            <option value="weekly" selected>Semanal</option>
                            <option value="biweekly">Quincenal</option>
                            <option value="monthly">Mensual</option>
                            <option value="annual">Anual</option>
                            <option value="custom">Personalizado</option>
                        </select>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Fecha de Inicio *</label>
                            <input type="date" class="form-control" id="reportStartDate" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Fecha de Fin *</label>
                            <input type="date" class="form-control" id="reportEndDate" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Título del Informe *</label>
                        <input type="text" class="form-control" id="reportTitleInput" required placeholder="Ej: Informe Semanal de Actividades">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Descripción</label>
                        <textarea class="form-control" id="reportDescription" rows="3" placeholder="Descripción del informe..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Incluir</label>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <label>
                                <input type="checkbox" id="includeTasks" checked>
                                <span>Tareas completadas</span>
                            </label>
                            <label>
                                <input type="checkbox" id="includeEvents" checked>
                                <span>Eventos y reuniones</span>
                            </label>
                            <label>
                                <input type="checkbox" id="includeBitacora" checked>
                                <span>Registros de bitácora</span>
                            </label>
                            <label>
                                <input type="checkbox" id="includeHours" checked>
                                <span>Horas trabajadas</span>
                            </label>
                            <label>
                                <input type="checkbox" id="includeStats" checked>
                                <span>Estadísticas de productividad</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Formato de Exportación</label>
                        <div class="export-options" style="justify-content: start;">
                            <label style="display: flex; align-items: center; gap: 8px; padding: 8px; border: 1px solid var(--border-color); border-radius: var(--radius-md);">
                                <input type="radio" name="exportFormat" value="pdf" checked>
                                <i class="fas fa-file-pdf"></i> PDF
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; padding: 8px; border: 1px solid var(--border-color); border-radius: var(--radius-md);">
                                <input type="radio" name="exportFormat" value="word">
                                <i class="fas fa-file-word"></i> Word
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; padding: 8px; border: 1px solid var(--border-color); border-radius: var(--radius-md);">
                                <input type="radio" name="exportFormat" value="excel">
                                <i class="fas fa-file-excel"></i> Excel
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelReportBtn">Cancelar</button>
                <button type="button" class="btn btn-primary" id="generateReportModalBtn">
                    <i class="fas fa-magic"></i> Generar con IA
                </button>
                <button type="button" class="btn btn-success" id="saveReportBtn">Generar Informe</button>
            </div>
        </div>
    </div>

    <!-- Contenedor de notificaciones -->
    <div class="notification-container" id="notificationContainer">
        <!-- Las notificaciones se agregan dinámicamente aquí -->
    </div>

    <!-- Scripts de terceros -->
    <script src="https://cdn.jsdelivr.net/npm/quill@2.0.0/dist/quill.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/locales/es.global.min.js"></script>
    
    <!-- Script principal -->
    <script>
        // ============================================
        // SISTEMA DE GESTIÓN LABORAL MEP 4.0
        // Versión: 4.0.0
        // Autor: Sistema DRTE
        // Fecha: Enero 2024
        // ============================================

        // Configuración global
        const CONFIG = {
            APP_NAME: 'Sistema de Gestión Laboral MEP',
            VERSION: '4.0.0',
            STORAGE_KEY: 'mep_system_v4',
            ENCRYPTION_KEY: 'mep-secret-key-2024', // En producción, usaría una clave segura
            AUTO_SAVE_INTERVAL: 300000, // 5 minutos
            BACKUP_INTERVAL: 1800000, // 30 minutos
            MAX_NOTIFICATIONS: 5,
            THEME: 'light'
        };

        // Estado global de la aplicación
        const AppState = {
            currentPage: 'dashboard',
            currentUser: {
                id: 'user-001',
                name: 'Asesor Nacional DRTE',
                email: '',
                role: 'Asesor Nacional',
                department: 'DRTE',
                avatar: 'AN'
            },
            settings: {
                theme: 'light',
                language: 'es',
                dateFormat: 'dd/mm/yyyy',
                timezone: 'America/Costa_Rica',
                notifications: {
                    tasks: true,
                    events: true,
                    reports: false,
                    email: true
                },
                autosave: true,
                autosaveFrequency: 5,
                encryptData: true
            },
            data: {
                tasks: [],
                events: [],
                notes: [],
                links: [],
                reports: [],
                bitacoras: []
            },
            ui: {
                sidebarOpen: true,
                notifications: [],
                modals: {
                    task: false,
                    event: false,
                    link: false,
                    report: false
                }
            }
        };

        // Clase principal del sistema
        class MEPSystem {
            constructor() {
                this.init();
            }

            // Inicialización del sistema
            async init() {
                console.log('🚀 Inicializando Sistema MEP 4.0...');
                
                try {
                    // Cargar datos guardados
                    await this.loadData();
                    
                    // Inicializar componentes
                    this.initUI();
                    this.initEventListeners();
                    this.initClock();
                    this.initCalendar();
                    this.initEditor();
                    
                    // Configurar auto-guardado
                    this.setupAutosave();
                    
                    // Configurar backup automático
                    this.setupAutoBackup();
                    
                    // Cargar datos iniciales
                    this.loadInitialData();
                    
                    // Mostrar notificación de bienvenida
                    this.showNotification(
                        '¡Bienvenido al Sistema MEP 4.0!',
                        'Sistema inicializado correctamente. Todas las funciones están listas.',
                        'success'
                    );
                    
                    console.log('✅ Sistema MEP 4.0 inicializado correctamente');
                } catch (error) {
                    console.error('❌ Error inicializando el sistema:', error);
                    this.showNotification(
                        'Error de inicialización',
                        'Hubo un problema al cargar el sistema. Algunas funciones podrían no estar disponibles.',
                        'error'
                    );
                }
            }

            // ============================================
            // SISTEMA DE DATOS Y ALMACENAMIENTO
            // ============================================

            // Cargar datos del almacenamiento local
            async loadData() {
                try {
                    const savedData = localStorage.getItem(CONFIG.STORAGE_KEY);
                    
                    if (savedData) {
                        // Intentar desencriptar si está encriptado
                        let data;
                        try {
                            data = JSON.parse(savedData);
                            
                            // Verificar si los datos están encriptados
                            if (data.encrypted && AppState.settings.encryptData) {
                                // En una implementación real, aquí se desencriptaría
                                // Por simplicidad, asumimos que no está encriptado para este ejemplo
                                data = data.data;
                            }
                            
                            // Cargar datos en el estado
                            if (data.settings) AppState.settings = { ...AppState.settings, ...data.settings };
                            if (data.data) AppState.data = { ...AppState.data, ...data.data };
                            if (data.currentUser) AppState.currentUser = { ...AppState.currentUser, ...data.currentUser };
                            
                            console.log('📂 Datos cargados correctamente');
                        } catch (e) {
                            console.warn('⚠️ No se pudieron cargar los datos guardados, usando datos por defecto');
                            this.createSampleData();
                        }
                    } else {
                        console.log('📝 No hay datos guardados, creando datos de ejemplo');
                        this.createSampleData();
                        this.saveData();
                    }
                    
                    // Aplicar configuración cargada
                    this.applySettings();
                } catch (error) {
                    console.error('❌ Error cargando datos:', error);
                    throw error;
                }
            }

            // Guardar datos en el almacenamiento local
            async saveData() {
                try {
                    const dataToSave = {
                        version: CONFIG.VERSION,
                        lastSaved: new Date().toISOString(),
                        settings: AppState.settings,
                        data: AppState.data,
                        currentUser: AppState.currentUser
                    };
                    
                    // Encriptar datos si está habilitado
                    let dataString;
                    if (AppState.settings.encryptData) {
                        // En una implementación real, aquí se encriptaría
                        dataString = JSON.stringify({
                            encrypted: true,
                            data: dataToSave
                        });
                    } else {
                        dataString = JSON.stringify(dataToSave);
                    }
                    
                    localStorage.setItem(CONFIG.STORAGE_KEY, dataString);
                    console.log('💾 Datos guardados correctamente');
                    
                    // Mostrar notificación de auto-guardado
                    this.showNotification('Auto-guardado', 'Datos guardados automáticamente', 'info', 2000);
                    
                    return true;
                } catch (error) {
                    console.error('❌ Error guardando datos:', error);
                    this.showNotification(
                        'Error guardando datos',
                        'No se pudieron guardar los cambios. Intenta nuevamente.',
                        'error'
                    );
                    return false;
                }
            }

            // Crear datos de ejemplo
            createSampleData() {
                const now = new Date();
                const today = now.toISOString().split('T')[0];
                
                // Tareas de ejemplo
                AppState.data.tasks = [
                    {
                        id: 'task-001',
                        title: 'Revisar informe mensual DRTE',
                        description: 'Revisar y aprobar el informe mensual de actividades de la Dirección de Recursos Tecnológicos',
                        priority: 'high',
                        status: 'pending',
                        dueDate: today,
                        estimatedTime: 3,
                        category: 'Administrativo',
                        assignee: 'Asesor Nacional',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'task-002',
                        title: 'Preparar presentación para reunión',
                        description: 'Preparar presentación sobre resultados del trimestre para reunión con directores',
                        priority: 'medium',
                        status: 'inprogress',
                        dueDate: new Date(now.getTime() + 86400000).toISOString().split('T')[0],
                        estimatedTime: 4,
                        category: 'Reuniones',
                        assignee: 'Asesor Nacional',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'task-003',
                        title: 'Actualizar base de datos de equipos',
                        description: 'Actualizar información en la base de datos de equipos tecnológicos del departamento',
                        priority: 'low',
                        status: 'completed',
                        dueDate: new Date(now.getTime() + 172800000).toISOString().split('T')[0],
                        estimatedTime: 2,
                        category: 'Técnico',
                        assignee: 'Asesor Nacional',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'task-004',
                        title: 'Capacitación de personal',
                        description: 'Coordinar capacitación sobre nuevas herramientas tecnológicas',
                        priority: 'medium',
                        status: 'pending',
                        dueDate: new Date(now.getTime() + 259200000).toISOString().split('T')[0],
                        estimatedTime: 5,
                        category: 'Capacitación',
                        assignee: 'Asesor Nacional',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'task-005',
                        title: 'Revisión de presupuesto',
                        description: 'Revisar y ajustar presupuesto del trimestre',
                        priority: 'high',
                        status: 'pending',
                        dueDate: new Date(now.getTime() - 86400000).toISOString().split('T')[0], // Ayer (vencida)
                        estimatedTime: 6,
                        category: 'Administrativo',
                        assignee: 'Asesor Nacional',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    }
                ];

                // Eventos de ejemplo
                AppState.data.events = [
                    {
                        id: 'event-001',
                        title: 'Reunión de equipo DRTE',
                        description: 'Reunión semanal del equipo de trabajo de la Dirección de Recursos Tecnológicos',
                        type: 'meeting',
                        color: '#6F42C1',
                        start: new Date(now.getFullYear(), now.getMonth(), now.getDate(), 9, 0).toISOString(),
                        end: new Date(now.getFullYear(), now.getMonth(), now.getDate(), 10, 30).toISOString(),
                        location: 'Sala de reuniones 3 - Edificio Central',
                        participants: 'Juan Pérez, María Gómez, Carlos López, Ana Rodríguez',
                        reminder: 15,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'event-002',
                        title: 'Entrega de informe trimestral',
                        description: 'Entrega del informe trimestral de actividades al Director',
                        type: 'report',
                        color: '#20C997',
                        start: new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1, 14, 0).toISOString(),
                        end: new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1, 15, 0).toISOString(),
                        location: 'Oficina del Director',
                        participants: 'Director del departamento',
                        reminder: 30,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'event-003',
                        title: 'Jornada de teletrabajo',
                        description: 'Jornada completa de teletrabajo según calendario',
                        type: 'teletrabajo',
                        color: '#28A745',
                        start: new Date(now.getFullYear(), now.getMonth(), now.getDate() + 2, 8, 0).toISOString(),
                        end: new Date(now.getFullYear(), now.getMonth(), now.getDate() + 2, 17, 0).toISOString(),
                        location: 'Teletrabajo',
                        participants: '',
                        reminder: 60,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    }
                ];

                // Notas de ejemplo (OneNote)
                AppState.data.notes = [
                    {
                        id: 'note-001',
                        title: 'Ideas para mejora del sistema',
                        content: '<h2>Ideas para mejorar el sistema de gestión</h2><p><strong>Objetivo:</strong> Optimizar el flujo de trabajo del departamento</p><ul><li>Integración con sistemas existentes del MEP</li><li>Automatización de reportes mensuales</li><li>Sistema de notificaciones inteligentes</li></ul>',
                        category: 'Ideas',
                        tags: ['mejora', 'sistema', 'optimización'],
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'note-002',
                        title: 'Minuta reunión equipo',
                        content: '<h2>Minuta de reunión - Equipo DRTE</h2><p><strong>Fecha:</strong> 25 de Enero, 2024</p><h3>Puntos tratados:</h3><ol><li>Revisión de proyectos en curso</li><li>Planificación del próximo trimestre</li><li>Distribución de responsabilidades</li></ol><h3>Acuerdos:</h3><ul><li>Completar informe mensual para el viernes</li><li>Programar capacitación de herramientas</li><li>Actualizar base de datos de equipos</li></ul>',
                        category: 'Reuniones',
                        tags: ['minuta', 'reunión', 'equipo'],
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    }
                ];

                // Enlaces de ejemplo
                AppState.data.links = [
                    {
                        id: 'link-001',
                        title: 'Portal Oficial MEP',
                        url: 'https://www.mep.go.cr',
                        description: 'Portal oficial del Ministerio de Educación Pública',
                        category: 'mep',
                        tags: ['oficial', 'portal', 'mep'],
                        favorite: true,
                        qrCode: null,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'link-002',
                        title: 'Correo Institucional',
                        url: 'https://outlook.office.com',
                        description: 'Acceso al correo institucional del MEP',
                        category: 'mep',
                        tags: ['correo', 'outlook', 'oficina'],
                        favorite: true,
                        qrCode: null,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'link-003',
                        title: 'Google Drive MEP',
                        url: 'https://drive.google.com',
                        description: 'Almacenamiento en la nube para documentos',
                        category: 'tools',
                        tags: ['drive', 'almacenamiento', 'google'],
                        favorite: false,
                        qrCode: null,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'link-004',
                        title: 'Symbaloo Recursos MEP',
                        url: 'https://www.symbaloo.com/home/mix/13eP7Bh97Y',
                        description: 'Tablero de recursos educativos organizados',
                        category: 'resources',
                        tags: ['symbaloo', 'recursos', 'educativos'],
                        favorite: true,
                        qrCode: null,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'link-005',
                        title: 'YouTube Educativo',
                        url: 'https://www.youtube.com',
                        description: 'Plataforma de videos educativos',
                        category: 'resources',
                        tags: ['youtube', 'videos', 'educación'],
                        favorite: false,
                        qrCode: null,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    }
                ];

                // Reportes de ejemplo
                AppState.data.reports = [
                    {
                        id: 'report-001',
                        title: 'Informe Semanal de Actividades',
                        type: 'weekly',
                        period: '22-26 Enero 2024',
                        content: 'Resumen de actividades realizadas durante la semana',
                        stats: {
                            hours: 42.5,
                            tasks: 8,
                            meetings: 3,
                            productivity: 85
                        },
                        format: 'pdf',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    }
                ];

                // Bitácoras de ejemplo
                AppState.data.bitacoras = [
                    {
                        id: 'bitacora-001',
                        date: today,
                        type: 'daily',
                        activities: [
                            'Revisión de documentos administrativos',
                            'Reunión de coordinación equipo DRTE',
                            'Elaboración de informe de actividades'
                        ],
                        hours: 8,
                        modality: 'oficina',
                        notes: 'Jornada productiva con avances significativos en los proyectos',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    }
                ];
            }

            // Exportar datos
            exportData() {
                try {
                    const exportData = {
                        app: CONFIG.APP_NAME,
                        version: CONFIG.VERSION,
                        exportDate: new Date().toISOString(),
                        data: AppState.data,
                        settings: AppState.settings,
                        currentUser: AppState.currentUser
                    };
                    
                    const dataStr = JSON.stringify(exportData, null, 2);
                    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                    
                    const exportFileDefaultName = `backup-mep-${new Date().toISOString().split('T')[0]}.json`;
                    
                    const linkElement = document.createElement('a');
                    linkElement.setAttribute('href', dataUri);
                    linkElement.setAttribute('download', exportFileDefaultName);
                    linkElement.click();
                    
                    this.showNotification(
                        'Exportación exitosa',
                        'Todos los datos han sido exportados correctamente',
                        'success'
                    );
                    
                    return true;
                } catch (error) {
                    console.error('❌ Error exportando datos:', error);
                    this.showNotification(
                        'Error exportando',
                        'No se pudieron exportar los datos',
                        'error'
                    );
                    return false;
                }
            }

            // Importar datos
            importData(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    
                    reader.onload = (event) => {
                        try {
                            const importedData = JSON.parse(event.target.result);
                            
                            // Validar estructura básica
                            if (!importedData.data || !importedData.settings) {
                                throw new Error('Formato de archivo inválido');
                            }
                            
                            // Actualizar datos
                            AppState.data = importedData.data;
                            AppState.settings = importedData.settings;
                            
                            // Guardar cambios
                            this.saveData();
                            
                            // Recargar la interfaz
                            this.reloadUI();
                            
                            this.showNotification(
                                'Importación exitosa',
                                'Datos importados correctamente',
                                'success'
                            );
                            
                            resolve(true);
                        } catch (error) {
                            console.error('❌ Error importando datos:', error);
                            this.showNotification(
                                'Error importando',
                                'El archivo no es válido o está corrupto',
                                'error'
                            );
                            reject(error);
                        }
                    };
                    
                    reader.onerror = () => {
                        reject(new Error('Error leyendo el archivo'));
                    };
                    
                    reader.readAsText(file);
                });
            }

            // Configurar auto-guardado
            setupAutosave() {
                if (AppState.settings.autosave) {
                    const interval = AppState.settings.autosaveFrequency * 60000; // Convertir a minutos
                    setInterval(() => {
                        this.saveData();
                    }, interval);
                    
                    console.log(`⏱️ Auto-guardado configurado cada ${AppState.settings.autosaveFrequency} minutos`);
                }
            }

            // Configurar backup automático
            setupAutoBackup() {
                setInterval(() => {
                    this.createBackup();
                }, CONFIG.BACKUP_INTERVAL);
                
                console.log('💽 Backup automático configurado cada 30 minutos');
            }

            // Crear backup
            createBackup() {
                try {
                    const backupKey = `mep_backup_${new Date().toISOString().split('T')[0]}`;
                    const backupData = {
                        timestamp: new Date().toISOString(),
                        data: AppState.data,
                        settings: AppState.settings
                    };
                    
                    localStorage.setItem(backupKey, JSON.stringify(backupData));
                    
                    // Limitar cantidad de backups (mantener solo los últimos 7)
                    this.cleanupOldBackups();
                    
                    return true;
                } catch (error) {
                    console.error('❌ Error creando backup:', error);
                    return false;
                }
            }

            // Limpiar backups antiguos
            cleanupOldBackups() {
                const backupKeys = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith('mep_backup_')) {
                        backupKeys.push(key);
                    }
                }
                
                // Ordenar por fecha (más reciente primero)
                backupKeys.sort().reverse();
                
                // Eliminar backups antiguos (mantener solo los últimos 7)
                if (backupKeys.length > 7) {
                    for (let i = 7; i < backupKeys.length; i++) {
                        localStorage.removeItem(backupKeys[i]);
                    }
                }
            }

            // ============================================
            // INTERFAZ DE USUARIO
            // ============================================

            // Inicializar interfaz de usuario
            initUI() {
                // Aplicar tema
                this.applyTheme();
                
                // Configurar navegación
                this.setupNavigation();
                
                // Actualizar reloj
                this.updateClock();
                
                // Configurar menú móvil
                this.setupMobileMenu();
                
                // Cargar página actual
                this.loadPage(AppState.currentPage);
            }

            // Aplicar configuración
            applySettings() {
                this.applyTheme();
                this.updateUserInfo();
            }

            // Aplicar tema
            applyTheme() {
                const theme = AppState.settings.theme;
                
                if (theme === 'auto') {
                    // Detectar preferencia del sistema
                    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    document.documentElement.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
                } else {
                    document.documentElement.setAttribute('data-theme', theme);
                }
                
                CONFIG.THEME = document.documentElement.getAttribute('data-theme');
            }

            // Actualizar información del usuario
            updateUserInfo() {
                const userNameElement = document.querySelector('.user-name');
                const userRoleElement = document.querySelector('.user-role');
                const userAvatarElement = document.querySelector('.user-avatar');
                
                if (userNameElement) {
                    userNameElement.textContent = AppState.currentUser.name;
                }
                
                if (userRoleElement) {
                    userRoleElement.textContent = AppState.currentUser.role;
                }
                
                if (userAvatarElement) {
                    userAvatarElement.textContent = AppState.currentUser.avatar;
                }
            }

            // Configurar navegación
            setupNavigation() {
                const navItems = document.querySelectorAll('.nav-item');
                
                navItems.forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        
                        const page = item.dataset.page;
                        if (page) {
                            this.navigateTo(page);
                        }
                    });
                });
                
                // Botones de acción rápida
                document.getElementById('quickTaskBtn')?.addEventListener('click', () => {
                    this.openTaskModal();
                });
                
                document.getElementById('quickEventBtn')?.addEventListener('click', () => {
                    this.openEventModal();
                });
                
                document.getElementById('quickReportBtn')?.addEventListener('click', () => {
                    this.openReportModal();
                });
            }

            // Navegar a página
            navigateTo(page) {
                // Actualizar item activo en sidebar
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                    if (item.dataset.page === page) {
                        item.classList.add('active');
                    }
                });
                
                // Actualizar título de página
                const pageTitles = {
                    dashboard: 'Dashboard',
                    calendar: 'Calendario',
                    tasks: 'Tareas',
                    bitacora: 'Bitácora OneNote',
                    reports: 'Informes',
                    links: 'Enlaces',
                    integrations: 'Integraciones',
                    assistant: 'Asistente IA',
                    settings: 'Configuración'
                };
                
                const pageTitleElement = document.getElementById('pageTitle');
                if (pageTitleElement) {
                    const iconElement = pageTitleElement.querySelector('i');
                    const titleElement = pageTitleElement.querySelector('span');
                    
                    if (titleElement) {
                        titleElement.textContent = pageTitles[page] || 'Dashboard';
                    }
                }
                
                // Ocultar todas las páginas
                document.querySelectorAll('.content-area > *').forEach(element => {
                    element.classList.remove('visible');
                    element.classList.add('hidden');
                });
                
                // Mostrar página seleccionada
                const pageElement = document.getElementById(`${page}Page`);
                if (pageElement) {
                    pageElement.classList.remove('hidden');
                    pageElement.classList.add('visible');
                    AppState.currentPage = page;
                    
                    // Cargar datos específicos de la página
                    this.loadPageData(page);
                }
                
                // Cerrar sidebar en móvil
                if (window.innerWidth <= 1200) {
                    this.closeSidebar();
                }
            }

            // Cargar datos de página
            loadPageData(page) {
                switch(page) {
                    case 'dashboard':
                        this.loadDashboardData();
                        break;
                    case 'calendar':
                        this.loadCalendarData();
                        break;
                    case 'tasks':
                        this.loadTasksData();
                        break;
                    case 'bitacora':
                        this.loadBitacoraData();
                        break;
                    case 'reports':
                        this.loadReportsData();
                        break;
                    case 'links':
                        this.loadLinksData();
                        break;
                    case 'integrations':
                        this.loadIntegrationsData();
                        break;
                    case 'assistant':
                        this.loadAssistantData();
                        break;
                    case 'settings':
                        this.loadSettingsData();
                        break;
                }
            }

            // Recargar interfaz completa
            reloadUI() {
                // Recargar página actual
                this.loadPageData(AppState.currentPage);
                
                // Actualizar estadísticas
                this.updateDashboardStats();
                
                // Actualizar badges
                this.updateBadges();
            }

            // Configurar menú móvil
            setupMobileMenu() {
                const menuToggle = document.getElementById('menuToggle');
                const sidebar = document.getElementById('sidebar');
                const mainContent = document.getElementById('mainContent');
                
                if (menuToggle && sidebar) {
                    menuToggle.addEventListener('click', () => {
                        sidebar.classList.toggle('active');
                        menuToggle.classList.toggle('active');
                        
                        // Bloquear scroll del body cuando el sidebar está abierto
                        if (sidebar.classList.contains('active')) {
                            document.body.style.overflow = 'hidden';
                        } else {
                            document.body.style.overflow = '';
                        }
                    });
                    
                    // Cerrar sidebar al hacer clic fuera en móvil
                    document.addEventListener('click', (e) => {
                        if (window.innerWidth <= 1200 && 
                            sidebar.classList.contains('active') &&
                            !sidebar.contains(e.target) && 
                            !menuToggle.contains(e.target)) {
                            this.closeSidebar();
                        }
                    });
                    
                    // Cerrar sidebar al cambiar tamaño de ventana
                    window.addEventListener('resize', () => {
                        if (window.innerWidth > 1200) {
                            this.closeSidebar();
                        }
                    });
                }
            }

            // Cerrar sidebar
            closeSidebar() {
                const sidebar = document.getElementById('sidebar');
                const menuToggle = document.getElementById('menuToggle');
                
                if (sidebar) {
                    sidebar.classList.remove('active');
                }
                
                if (menuToggle) {
                    menuToggle.classList.remove('active');
                }
                
                document.body.style.overflow = '';
            }

            // Cargar página
            loadPage(page) {
                this.navigateTo(page);
            }

            // Cargar datos iniciales
            loadInitialData() {
                this.updateDashboardStats();
                this.updateBadges();
                this.loadDashboardData();
            }

            // ============================================
            // DASHBOARD
            // ============================================

            // Cargar datos del dashboard
            loadDashboardData() {
                this.updateDashboardStats();
                this.loadRecentActivity();
                this.loadUpcomingEvents();
            }

            // Actualizar estadísticas del dashboard
            updateDashboardStats() {
                const tasks = AppState.data.tasks;
                const events = AppState.data.events;
                const bitacoras = AppState.data.bitacoras;
                
                // Tareas pendientes
                const pendingTasks = tasks.filter(task => task.status !== 'completed').length;
                document.getElementById('statPendingTasks').textContent = pendingTasks;
                
                // Horas esta semana
                const now = new Date();
                const startOfWeek = new Date(now.setDate(now.getDate() - now.getDay()));
                const weeklyBitacoras = bitacoras.filter(b => new Date(b.createdAt) >= startOfWeek);
                const weeklyHours = weeklyBitacoras.reduce((total, b) => total + (b.hours || 0), 0);
                document.getElementById('statWeeklyHours').textContent = weeklyHours.toFixed(1);
                
                // Próximas reuniones
                const today = new Date().toISOString().split('T')[0];
                const upcomingEvents = events.filter(e => 
                    new Date(e.start).toISOString().split('T')[0] >= today
                );
                document.getElementById('statUpcomingMeetings').textContent = upcomingEvents.length;
                
                // Informes pendientes
                document.getElementById('statPendingReports').textContent = '2'; // Valor de ejemplo
                
                // Actualizar badges
                this.updateBadges();
            }

            // Actualizar badges
            updateBadges() {
                const tasks = AppState.data.tasks;
                const pendingTasks = tasks.filter(task => task.status !== 'completed').length;
                const overdueTasks = tasks.filter(task => {
                    if (task.status !== 'completed' && task.dueDate) {
                        const dueDate = new Date(task.dueDate);
                        const today = new Date();
                        today.setHours(0, 0, 0, 0);
                        return dueDate < today;
                    }
                    return false;
                }).length;
                
                // Actualizar badge de tareas
                const tasksBadge = document.getElementById('tasksBadge');
                if (tasksBadge) {
                    tasksBadge.textContent = pendingTasks;
                    tasksBadge.style.display = pendingTasks > 0 ? 'flex' : 'none';
                }
                
                // Actualizar badge de dashboard
                const dashboardBadge = document.getElementById('dashboardBadge');
                if (dashboardBadge) {
                    const totalNotifications = pendingTasks + overdueTasks;
                    dashboardBadge.textContent = totalNotifications;
                    dashboardBadge.style.display = totalNotifications > 0 ? 'flex' : 'none';
                }
                
                // Actualizar badge de bitácora
                const bitacoraBadge = document.getElementById('bitacoraBadge');
                if (bitacoraBadge) {
                    const today = new Date().toISOString().split('T')[0];
                    const hasTodayBitacora = AppState.data.bitacoras.some(b => 
                        b.date === today
                    );
                    bitacoraBadge.textContent = hasTodayBitacora ? '' : 'Nuevo';
                    bitacoraBadge.style.display = hasTodayBitacora ? 'none' : 'flex';
                }
                
                // Actualizar badge de enlaces
                const linksBadge = document.getElementById('linksBadge');
                if (linksBadge) {
                    linksBadge.textContent = AppState.data.links.length;
                    linksBadge.style.display = AppState.data.links.length > 0 ? 'flex' : 'none';
                }
            }

            // Cargar actividad reciente
            loadRecentActivity() {
                const activityList = document.getElementById('recentActivity');
                if (!activityList) return;
                
                // Combinar actividades de diferentes fuentes
                const allActivities = [];
                
                // Tareas recientes
                AppState.data.tasks
                    .sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt))
                    .slice(0, 3)
                    .forEach(task => {
                        allActivities.push({
                            type: 'task',
                            icon: 'fas fa-tasks',
                            iconClass: 'task',
                            title: task.title,
                            description: `Tarea ${this.getStatusLabel(task.status)}`,
                            time: task.updatedAt,
                            data: task
                        });
                    });
                
                // Eventos recientes
                AppState.data.events
                    .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                    .slice(0, 2)
                    .forEach(event => {
                        allActivities.push({
                            type: 'event',
                            icon: 'fas fa-calendar',
                            iconClass: 'event',
                            title: event.title,
                            description: `Evento ${this.getEventTypeLabel(event.type)}`,
                            time: event.createdAt,
                            data: event
                        });
                    });
                
                // Notas recientes
                AppState.data.notes
                    .sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt))
                    .slice(0, 2)
                    .forEach(note => {
                        allActivities.push({
                            type: 'note',
                            icon: 'fas fa-sticky-note',
                            iconClass: 'bitacora',
                            title: note.title,
                            description: 'Nota actualizada',
                            time: note.updatedAt,
                            data: note
                        });
                    });
                
                // Ordenar por fecha
                allActivities.sort((a, b) => new Date(b.time) - new Date(a.time));
                
                // Limitar a 5 actividades
                const recentActivities = allActivities.slice(0, 5);
                
                // Limpiar lista
                activityList.innerHTML = '';
                
                // Agregar actividades
                if (recentActivities.length === 0) {
                    activityList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-inbox"></i>
                            <div>No hay actividad reciente</div>
                        </div>
                    `;
                    return;
                }
                
                recentActivities.forEach(activity => {
                    const activityItem = document.createElement('div');
                    activityItem.className = 'activity-item';
                    
                    activityItem.innerHTML = `
                        <div class="activity-icon ${activity.iconClass}">
                            <i class="${activity.icon}"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">${activity.title}</div>
                            <div class="activity-time">
                                ${activity.description} • ${this.formatRelativeTime(new Date(activity.time))}
                            </div>
                        </div>
                    `;
                    
                    // Agregar evento de clic
                    activityItem.addEventListener('click', () => {
                        this.handleActivityClick(activity);
                    });
                    
                    activityList.appendChild(activityItem);
                });
            }

            // Manejar clic en actividad
            handleActivityClick(activity) {
                switch(activity.type) {
                    case 'task':
                        this.openTaskModal(activity.data);
                        break;
                    case 'event':
                        this.openEventModal(activity.data);
                        break;
                    case 'note':
                        // Navegar a bitácora y cargar la nota
                        this.navigateTo('bitacora');
                        setTimeout(() => {
                            this.loadNote(activity.data.id);
                        }, 100);
                        break;
                }
            }

            // Cargar próximos eventos
            loadUpcomingEvents() {
                const eventList = document.getElementById('upcomingEvents');
                if (!eventList) return;
                
                const now = new Date();
                const upcomingEvents = AppState.data.events
                    .filter(event => new Date(event.start) > now)
                    .sort((a, b) => new Date(a.start) - new Date(b.start))
                    .slice(0, 3);
                
                // Limpiar lista
                eventList.innerHTML = '';
                
                if (upcomingEvents.length === 0) {
                    eventList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-calendar"></i>
                            <div>No hay eventos próximos</div>
                        </div>
                    `;
                    return;
                }
                
                upcomingEvents.forEach(event => {
                    const eventItem = document.createElement('div');
                    eventItem.className = 'event-item';
                    
                    const startDate = new Date(event.start);
                    const timeString = startDate.toLocaleTimeString('es-CR', { 
                        hour: '2-digit', 
                        minute: '2-digit'
                    });
                    const dateString = startDate.toLocaleDateString('es-CR', {
                        weekday: 'short',
                        day: 'numeric'
                    });
                    
                    eventItem.innerHTML = `
                        <div style="flex: 1;">
                            <div class="activity-title">${event.title}</div>
                            <div class="activity-time">
                                <i class="fas fa-clock"></i>
                                ${dateString} • ${timeString}
                            </div>
                        </div>
                        <div class="event-type" style="background: ${event.color}; color: white; padding: 4px 8px; border-radius: var(--radius-sm); font-size: 12px;">
                            ${this.getEventTypeLabel(event.type)}
                        </div>
                    `;
                    
                    // Agregar evento de clic
                    eventItem.addEventListener('click', () => {
                        this.openEventModal(event);
                    });
                    
                    eventList.appendChild(eventItem);
                });
            }

            // ============================================
            // CALENDARIO
            // ============================================

            // Inicializar calendario
            initCalendar() {
                try {
                    const calendarEl = document.getElementById('calendar');
                    if (!calendarEl) return;
                    
                    this.calendar = new FullCalendar.Calendar(calendarEl, {
                        locale: 'es',
                        initialView: 'dayGridMonth',
                        headerToolbar: false,
                        weekends: true,
                        editable: true,
                        selectable: true,
                        dayMaxEvents: 3,
                        events: this.formatEventsForCalendar(),
                        eventClick: (info) => {
                            this.handleCalendarEventClick(info.event);
                        },
                        dateClick: (info) => {
                            this.handleCalendarDateClick(info.date);
                        },
                        eventDrop: (info) => {
                            this.handleCalendarEventDrop(info.event);
                        },
                        eventResize: (info) => {
                            this.handleCalendarEventResize(info.event);
                        }
                    });
                    
                    this.calendar.render();
                    
                    // Configurar botones de navegación
                    this.setupCalendarNavigation();
                    
                    console.log('📅 Calendario inicializado correctamente');
                } catch (error) {
                    console.error('❌ Error inicializando calendario:', error);
                }
            }

            // Formatear eventos para FullCalendar
            formatEventsForCalendar() {
                return AppState.data.events.map(event => ({
                    id: event.id,
                    title: event.title,
                    start: event.start,
                    end: event.end,
                    color: event.color,
                    extendedProps: {
                        description: event.description,
                        type: event.type,
                        location: event.location,
                        participants: event.participants
                    }
                }));
            }

            // Configurar navegación del calendario
            setupCalendarNavigation() {
                // Botones de navegación
                document.getElementById('prevBtn')?.addEventListener('click', () => {
                    this.calendar.prev();
                    this.updateCalendarTitle();
                });
                
                document.getElementById('nextBtn')?.addEventListener('click', () => {
                    this.calendar.next();
                    this.updateCalendarTitle();
                });
                
                document.getElementById('todayBtn')?.addEventListener('click', () => {
                    this.calendar.today();
                    this.updateCalendarTitle();
                });
                
                // Botones de vista
                document.querySelectorAll('.view-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const view = btn.dataset.view;
                        
                        // Actualizar botones activos
                        document.querySelectorAll('.view-btn').forEach(b => {
                            b.classList.remove('active');
                        });
                        btn.classList.add('active');
                        
                        // Cambiar vista
                        this.calendar.changeView(this.getCalendarViewName(view));
                        this.updateCalendarTitle();
                    });
                });
                
                // Nuevo evento desde calendario
                document.getElementById('newCalendarEventBtn')?.addEventListener('click', () => {
                    this.openEventModal();
                });
                
                // Actualizar título inicial
                this.updateCalendarTitle();
            }

            // Obtener nombre de vista de FullCalendar
            getCalendarViewName(view) {
                const viewMap = {
                    'day': 'timeGridDay',
                    'week': 'timeGridWeek',
                    'month': 'dayGridMonth',
                    'list': 'listWeek'
                };
                
                return viewMap[view] || 'dayGridMonth';
            }

            // Actualizar título del calendario
            updateCalendarTitle() {
                if (!this.calendar) return;
                
                const currentDateElement = document.getElementById('currentDate');
                if (!currentDateElement) return;
                
                const view = this.calendar.view;
                const date = view.currentStart;
                
                let title = '';
                switch (view.type) {
                    case 'dayGridMonth':
                        title = date.toLocaleDateString('es-CR', { month: 'long', year: 'numeric' });
                        break;
                    case 'timeGridWeek':
                        const weekStart = new Date(date);
                        const weekEnd = new Date(date);
                        weekEnd.setDate(weekEnd.getDate() + 6);
                        
                        title = `${weekStart.toLocaleDateString('es-CR', { day: 'numeric', month: 'short' })} - ${weekEnd.toLocaleDateString('es-CR', { day: 'numeric', month: 'short', year: 'numeric' })}`;
                        break;
                    case 'timeGridDay':
                        title = date.toLocaleDateString('es-CR', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
                        break;
                    case 'listWeek':
                        title = 'Lista de Eventos';
                        break;
                    default:
                        title = date.toLocaleDateString('es-CR');
                }
                
                currentDateElement.textContent = title;
            }

            // Manejar clic en evento del calendario
            handleCalendarEventClick(event) {
                const eventData = AppState.data.events.find(e => e.id === event.id);
                if (eventData) {
                    this.openEventModal(eventData);
                }
            }

            // Manejar clic en fecha del calendario
            handleCalendarDateClick(date) {
                // Abrir modal de nuevo evento con la fecha seleccionada
                this.openEventModal(null, date);
            }

            // Manejar arrastre de evento
            handleCalendarEventDrop(event) {
                const eventData = AppState.data.events.find(e => e.id === event.id);
                if (eventData) {
                    eventData.start = event.start.toISOString();
                    if (event.end) {
                        eventData.end = event.end.toISOString();
                    }
                    eventData.updatedAt = new Date().toISOString();
                    
                    this.saveData();
                    this.showNotification('Evento actualizado', 'El evento ha sido reprogramado', 'success');
                }
            }

            // Manejar cambio de duración de evento
            handleCalendarEventResize(event) {
                const eventData = AppState.data.events.find(e => e.id === event.id);
                if (eventData) {
                    eventData.end = event.end.toISOString();
                    eventData.updatedAt = new Date().toISOString();
                    
                    this.saveData();
                    this.showNotification('Evento actualizado', 'La duración del evento ha sido modificada', 'success');
                }
            }

            // Cargar datos del calendario
            loadCalendarData() {
                if (this.calendar) {
                    // Actualizar eventos
                    this.calendar.removeAllEvents();
                    this.calendar.addEventSource(this.formatEventsForCalendar());
                    
                    // Actualizar título
                    this.updateCalendarTitle();
                } else {
                    // Inicializar calendario si no está inicializado
                    setTimeout(() => {
                        this.initCalendar();
                    }, 100);
                }
            }

            // ============================================
            // TAREAS
            // ============================================

            // Cargar datos de tareas
            loadTasksData() {
                this.renderTasks();
                this.setupTaskFilters();
            }

            // Renderizar tareas
            renderTasks(filter = 'all') {
                const tasksGrid = document.getElementById('tasksGrid');
                if (!tasksGrid) return;
                
                let filteredTasks = [...AppState.data.tasks];
                
                // Aplicar filtro
                switch(filter) {
                    case 'pending':
                        filteredTasks = filteredTasks.filter(t => t.status === 'pending');
                        break;
                    case 'inprogress':
                        filteredTasks = filteredTasks.filter(t => t.status === 'inprogress');
                        break;
                    case 'completed':
                        filteredTasks = filteredTasks.filter(t => t.status === 'completed');
                        break;
                    case 'high':
                        filteredTasks = filteredTasks.filter(t => t.priority === 'high');
                        break;
                    case 'overdue':
                        filteredTasks = filteredTasks.filter(t => {
                            if (t.status !== 'completed' && t.dueDate) {
                                const dueDate = new Date(t.dueDate);
                                const today = new Date();
                                today.setHours(0, 0, 0, 0);
                                return dueDate < today;
                            }
                            return false;
                        });
                        break;
                    // 'all' no filtra
                }
                
                // Ordenar por fecha límite (las más próximas primero)
                filteredTasks.sort((a, b) => {
                    if (!a.dueDate && !b.dueDate) return 0;
                    if (!a.dueDate) return 1;
                    if (!b.dueDate) return -1;
                    return new Date(a.dueDate) - new Date(b.dueDate);
                });
                
                // Limpiar grid
                tasksGrid.innerHTML = '';
                
                if (filteredTasks.length === 0) {
                    tasksGrid.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-tasks"></i>
                            <div>No hay tareas ${filter !== 'all' ? 'con este filtro' : 'creadas aún'}</div>
                            ${filter !== 'all' ? '<button class="btn btn-primary mt-2" id="clearFilterBtn">Limpiar filtro</button>' : ''}
                        </div>
                    `;
                    
                    // Configurar botón de limpiar filtro
                    document.getElementById('clearFilterBtn')?.addEventListener('click', () => {
                        document.querySelectorAll('.filter-btn').forEach(btn => {
                            btn.classList.remove('active');
                            if (btn.dataset.filter === 'all') {
                                btn.classList.add('active');
                            }
                        });
                        this.renderTasks('all');
                    });
                    
                    return;
                }
                
                // Renderizar tareas
                filteredTasks.forEach(task => {
                    const taskCard = this.createTaskCard(task);
                    tasksGrid.appendChild(taskCard);
                });
            }

            // Crear tarjeta de tarea
            createTaskCard(task) {
                const taskCard = document.createElement('div');
                taskCard.className = `task-card ${task.priority} ${task.status === 'completed' ? 'completed' : ''}`;
                
                const dueDate = new Date(task.dueDate);
                const now = new Date();
                const isOverdue = dueDate < now && task.status !== 'completed';
                const isToday = dueDate.toDateString() === now.toDateString();
                
                // Formatear fecha
                let dueDateText = dueDate.toLocaleDateString('es-CR');
                if (isToday) {
                    dueDateText = 'Hoy';
                } else if (isOverdue) {
                    dueDateText = `Vencida: ${dueDateText}`;
                }
                
                taskCard.innerHTML = `
                    <div class="task-header">
                        <div style="flex: 1">
                            <div class="task-title">${task.title}</div>
                            <div class="task-priority priority-${task.priority}">
                                ${this.getPriorityLabel(task.priority)}
                            </div>
                        </div>
                        <div class="task-actions">
                            <button class="action-btn edit-task" data-id="${task.id}" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete delete-task" data-id="${task.id}" title="Eliminar">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="task-due ${isOverdue ? 'overdue' : ''}">
                        <i class="fas fa-calendar"></i>
                        ${dueDateText}
                    </div>
                    <div class="task-description">${task.description || 'Sin descripción'}</div>
                    <div class="task-footer">
                        <div class="task-status status-${task.status}">
                            ${this.getStatusLabel(task.status)}
                        </div>
                        <div style="color: var(--text-secondary); font-size: 12px;">
                            <i class="fas fa-clock"></i>
                            ${task.estimatedTime || 0}h
                        </div>
                    </div>
                `;
                
                // Agregar eventos a los botones
                const editBtn = taskCard.querySelector('.edit-task');
                const deleteBtn = taskCard.querySelector('.delete-task');
                
                editBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.openTaskModal(task);
                });
                
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.deleteTask(task.id);
                });
                
                // Agregar evento de clic a la tarjeta completa
                taskCard.addEventListener('click', () => {
                    this.openTaskModal(task);
                });
                
                return taskCard;
            }

            // Configurar filtros de tareas
            setupTaskFilters() {
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const filter = btn.dataset.filter;
                        
                        // Actualizar botones activos
                        document.querySelectorAll('.filter-btn').forEach(b => {
                            b.classList.remove('active');
                        });
                        btn.classList.add('active');
                        
                        // Renderizar tareas filtradas
                        this.renderTasks(filter);
                    });
                });
                
                // Botón de nueva tarea
                document.getElementById('newTaskBtn')?.addEventListener('click', () => {
                    this.openTaskModal();
                });
            }

            // Abrir modal de tarea
            openTaskModal(task = null) {
                const modal = document.getElementById('taskModal');
                const modalTitle = document.getElementById('taskModalTitle');
                
                if (task) {
                    modalTitle.textContent = 'Editar Tarea';
                    
                    // Llenar formulario con datos de la tarea
                    document.getElementById('taskTitle').value = task.title;
                    document.getElementById('taskDescription').value = task.description || '';
                    document.getElementById('taskPriority').value = task.priority;
                    document.getElementById('taskDueDate').value = task.dueDate;
                    document.getElementById('taskStatus').value = task.status;
                    document.getElementById('taskEstimatedTime').value = task.estimatedTime || 2;
                    document.getElementById('taskCategory').value = task.category || '';
                    document.getElementById('taskAssignee').value = task.assignee || '';
                    
                    // Guardar referencia a la tarea que se está editando
                    this.editingTaskId = task.id;
                } else {
                    modalTitle.textContent = 'Nueva Tarea';
                    
                    // Limpiar formulario
                    document.getElementById('taskForm').reset();
                    
                    // Establecer valores por defecto
                    const tomorrow = new Date();
                    tomorrow.setDate(tomorrow.getDate() + 1);
                    document.getElementById('taskDueDate').value = tomorrow.toISOString().split('T')[0];
                    document.getElementById('taskStatus').value = 'pending';
                    document.getElementById('taskPriority').value = 'medium';
                    document.getElementById('taskEstimatedTime').value = 2;
                    
                    // Limpiar referencia de edición
                    this.editingTaskId = null;
                }
                
                // Mostrar modal
                modal.classList.add('active');
                AppState.ui.modals.task = true;
            }

            // Guardar tarea
            async saveTask() {
                try {
                    const form = document.getElementById('taskForm');
                    
                    if (!form.checkValidity()) {
                        form.reportValidity();
                        return false;
                    }
                    
                    const taskData = {
                        title: document.getElementById('taskTitle').value.trim(),
                        description: document.getElementById('taskDescription').value.trim(),
                        priority: document.getElementById('taskPriority').value,
                        dueDate: document.getElementById('taskDueDate').value,
                        status: document.getElementById('taskStatus').value,
                        estimatedTime: parseFloat(document.getElementById('taskEstimatedTime').value) || 0,
                        category: document.getElementById('taskCategory').value.trim(),
                        assignee: document.getElementById('taskAssignee').value.trim(),
                        updatedAt: new Date().toISOString()
                    };
                    
                    if (this.editingTaskId) {
                        // Actualizar tarea existente
                        const index = AppState.data.tasks.findIndex(t => t.id === this.editingTaskId);
                        if (index !== -1) {
                            AppState.data.tasks[index] = {
                                ...AppState.data.tasks[index],
                                ...taskData
                            };
                            
                            this.showNotification('Tarea actualizada', 'La tarea ha sido actualizada correctamente', 'success');
                        }
                    } else {
                        // Crear nueva tarea
                        const newTask = {
                            id: 'task-' + Date.now(),
                            ...taskData,
                            createdAt: new Date().toISOString()
                        };
                        
                        AppState.data.tasks.push(newTask);
                        this.showNotification('Tarea creada', 'La tarea ha sido creada correctamente', 'success');
                    }
                    
                    // Guardar datos
                    await this.saveData();
                    
                    // Cerrar modal
                    this.closeTaskModal();
                    
                    // Recargar tareas si estamos en la página de tareas
                    if (AppState.currentPage === 'tasks') {
                        this.renderTasks();
                    }
                    
                    // Actualizar dashboard
                    this.updateDashboardStats();
                    this.updateBadges();
                    
                    return true;
                } catch (error) {
                    console.error('❌ Error guardando tarea:', error);
                    this.showNotification('Error', 'No se pudo guardar la tarea', 'error');
                    return false;
                }
            }

            // Eliminar tarea
            async deleteTask(taskId) {
                if (!confirm('¿Está seguro de que desea eliminar esta tarea?')) {
                    return;
                }
                
                try {
                    const index = AppState.data.tasks.findIndex(t => t.id === taskId);
                    if (index !== -1) {
                        AppState.data.tasks.splice(index, 1);
                        
                        await this.saveData();
                        
                        this.showNotification('Tarea eliminada', 'La tarea ha sido eliminada correctamente', 'success');
                        
                        // Recargar tareas si estamos en la página de tareas
                        if (AppState.currentPage === 'tasks') {
                            this.renderTasks();
                        }
                        
                        // Actualizar dashboard
                        this.updateDashboardStats();
                        this.updateBadges();
                    }
                } catch (error) {
                    console.error('❌ Error eliminando tarea:', error);
                    this.showNotification('Error', 'No se pudo eliminar la tarea', 'error');
                }
            }

            // Cerrar modal de tarea
            closeTaskModal() {
                const modal = document.getElementById('taskModal');
                modal.classList.remove('active');
                AppState.ui.modals.task = false;
                this.editingTaskId = null;
            }

            // ============================================
            // BITÁCORA ONENOTE
            // ============================================

            // Inicializar editor
            initEditor() {
                try {
                    // Configurar editor básico
                    const editorContent = document.getElementById('editorContent');
                    if (!editorContent) return;
                    
                    // Configurar placeholder
                    editorContent.addEventListener('focus', function() {
                        if (this.textContent === this.dataset.placeholder) {
                            this.textContent = '';
                        }
                    });
                    
                    editorContent.addEventListener('blur', function() {
                        if (this.textContent === '') {
                            this.textContent = this.dataset.placeholder;
                        }
                    });
                    
                    // Configurar barra de herramientas
                    this.setupEditorToolbar();
                    
                    // Cargar notas guardadas
                    this.loadSavedNotes();
                    
                    console.log('📝 Editor inicializado correctamente');
                } catch (error) {
                    console.error('❌ Error inicializando editor:', error);
                }
            }

            // Configurar barra de herramientas del editor
            setupEditorToolbar() {
                const toolbar = document.getElementById('editorToolbar');
                if (!toolbar) return;
                
                // Botones de formato
                toolbar.querySelectorAll('button[data-command]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const command = btn.dataset.command;
                        const value = btn.dataset.value;
                        
                        this.executeEditorCommand(command, value);
                    });
                });
                
                // Botón guardar
                document.getElementById('saveNoteBtn')?.addEventListener('click', () => {
                    this.saveNote();
                });
                
                // Botón limpiar
                document.getElementById('clearNoteBtn')?.addEventListener('click', () => {
                    this.clearEditor();
                });
                
                // Plantillas
                document.querySelectorAll('.template-card').forEach(card => {
                    card.addEventListener('click', () => {
                        const template = card.dataset.template;
                        this.loadTemplate(template);
                    });
                });
            }

            // Ejecutar comando del editor
            executeEditorCommand(command, value) {
                const editor = document.getElementById('editorContent');
                if (!editor) return;
                
                document.execCommand(command === 'format' ? value : command, false, value);
                editor.focus();
            }

            // Guardar nota
            async saveNote() {
                try {
                    const editor = document.getElementById('editorContent');
                    if (!editor) return;
                    
                    const content = editor.innerHTML;
                    const title = this.extractNoteTitle(content) || 'Nota sin título';
                    
                    const noteData = {
                        title: title,
                        content: content,
                        category: 'General',
                        tags: [],
                        updatedAt: new Date().toISOString()
                    };
                    
                    // Buscar si ya existe una nota con el mismo contenido
                    const existingIndex = AppState.data.notes.findIndex(n => 
                        n.content === content
                    );
                    
                    if (existingIndex !== -1) {
                        // Actualizar nota existente
                        AppState.data.notes[existingIndex] = {
                            ...AppState.data.notes[existingIndex],
                            ...noteData
                        };
                        
                        this.showNotification('Nota actualizada', 'La nota ha sido actualizada', 'success');
                    } else {
                        // Crear nueva nota
                        const newNote = {
                            id: 'note-' + Date.now(),
                            ...noteData,
                            createdAt: new Date().toISOString()
                        };
                        
                        AppState.data.notes.push(newNote);
                        this.showNotification('Nota guardada', 'La nota ha sido guardada', 'success');
                    }
                    
                    // Guardar datos
                    await this.saveData();
                    
                    // Recargar lista de notas
                    this.loadSavedNotes();
                    
                    return true;
                } catch (error) {
                    console.error('❌ Error guardando nota:', error);
                    this.showNotification('Error', 'No se pudo guardar la nota', 'error');
                    return false;
                }
            }

            // Extraer título de la nota
            extractNoteTitle(content) {
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = content;
                
                // Buscar el primer elemento h1, h2, h3 o el primer párrafo
                const headings = tempDiv.querySelectorAll('h1, h2, h3');
                if (headings.length > 0) {
                    return headings[0].textContent.trim();
                }
                
                const paragraphs = tempDiv.querySelectorAll('p');
                if (paragraphs.length > 0) {
                    const firstParagraph = paragraphs[0].textContent.trim();
                    return firstParagraph.length > 50 ? firstParagraph.substring(0, 50) + '...' : firstParagraph;
                }
                
                // Si no hay elementos HTML, usar el texto plano
                const text = tempDiv.textContent.trim();
                return text.length > 50 ? text.substring(0, 50) + '...' : text;
            }

            // Limpiar editor
            clearEditor() {
                if (!confirm('¿Está seguro de que desea limpiar el editor? Se perderán los cambios no guardados.')) {
                    return;
                }
                
                const editor = document.getElementById('editorContent');
                if (editor) {
                    editor.innerHTML = '';
                    editor.textContent = editor.dataset.placeholder;
                }
            }

            // Cargar plantilla
            loadTemplate(template) {
                const editor = document.getElementById('editorContent');
                if (!editor) return;
                
                const templates = {
                    daily: `
                        <h2>INFORME DIARIO DE ACTIVIDADES</h2>
                        <p><strong>Fecha:</strong> ${new Date().toLocaleDateString('es-CR')}</p>
                        <p><strong>Modalidad:</strong> Oficina / Teletrabajo</p>
                        
                        <h3>📋 ACTIVIDADES REALIZADAS</h3>
                        <ul>
                            <li>Actividad 1</li>
                            <li>Actividad 2</li>
                            <li>Actividad 3</li>
                        </ul>
                        
                        <h3>🎯 LOGROS Y RESULTADOS</h3>
                        <p>Descripción de logros alcanzados...</p>
                        
                        <h3>🚧 DIFICULTADES ENCONTRADAS</h3>
                        <p>Descripción de dificultades encontradas...</p>
                        
                        <h3>📅 PLANIFICACIÓN PARA MAÑANA</h3>
                        <ul>
                            <li>Tarea pendiente 1</li>
                            <li>Tarea pendiente 2</li>
                        </ul>
                        
                        <h3>💡 OBSERVACIONES</h3>
                        <p>Observaciones adicionales...</p>
                    `,
                    weekly: `
                        <h2>INFORME SEMANAL DE ACTIVIDADES</h2>
                        <p><strong>Semana:</strong> ${this.getWeekRange()}</p>
                        <p><strong>Departamento:</strong> DRTE</p>
                        <p><strong>Responsable:</strong> ${AppState.currentUser.name}</p>
                        
                        <h3>📊 RESUMEN EJECUTIVO</h3>
                        <p>Resumen general de las actividades realizadas durante la semana...</p>
                        
                        <h3>✅ ACTIVIDADES COMPLETADAS</h3>
                        <ul>
                            <li>Actividad importante 1</li>
                            <li>Actividad importante 2</li>
                            <li>Actividad importante 3</li>
                        </ul>
                        
                        <h3>📈 AVANCE DE PROYECTOS</h3>
                        <p>Estado actual de los proyectos en curso...</p>
                        
                        <h3>📅 PLANIFICACIÓN PRÓXIMA SEMANA</h3>
                        <ul>
                            <li>Objetivo 1</li>
                            <li>Objetivo 2</li>
                            <li>Objetivo 3</li>
                        </ul>
                    `,
                    monthly: `
                        <h2>INFORME MENSUAL DE ACTIVIDADES</h2>
                        <p><strong>Mes:</strong> ${new Date().toLocaleDateString('es-CR', { month: 'long', year: 'numeric' })}</p>
                        <p><strong>Departamento:</strong> DRTE</p>
                        
                        <h3>🎯 OBJETIVOS DEL MES</h3>
                        <ul>
                            <li>Objetivo 1 (Estado: Completado)</li>
                            <li>Objetivo 2 (Estado: En progreso)</li>
                            <li>Objetivo 3 (Estado: Pendiente)</li>
                        </ul>
                        
                        <h3>📊 ESTADÍSTICAS DEL MES</h3>
                        <ul>
                            <li>Horas trabajadas: 160 horas</li>
                            <li>Tareas completadas: 25 tareas</li>
                            <li>Reuniones: 8 reuniones</li>
                            <li>Informes generados: 4 informes</li>
                        </ul>
                        
                        <h3>✅ LOGROS PRINCIPALES</h3>
                        <p>Descripción de los logros más importantes del mes...</p>
                        
                        <h3>🚧 DIFICULTADES ENCONTRADAS</h3>
                        <p>Principales dificultades y soluciones implementadas...</p>
                        
                        <h3>📅 PLANIFICACIÓN PRÓXIMO MES</h3>
                        <ul>
                            <li>Meta 1</li>
                            <li>Meta 2</li>
                            <li>Meta 3</li>
                        </ul>
                    `,
                    meeting: `
                        <h2>ACTA DE REUNIÓN</h2>
                        <p><strong>Fecha:</strong> ${new Date().toLocaleDateString('es-CR')}</p>
                        <p><strong>Hora:</strong> ${new Date().toLocaleTimeString('es-CR', { hour: '2-digit', minute: '2-digit' })}</p>
                        <p><strong>Lugar:</strong> Sala de reuniones / Virtual</p>
                        
                        <h3>👥 ASISTENTES</h3>
                        <ul>
                            <li>Nombre 1</li>
                            <li>Nombre 2</li>
                            <li>Nombre 3</li>
                        </ul>
                        
                        <h3>📋 ORDEN DEL DÍA</h3>
                        <ol>
                            <li>Punto 1</li>
                            <li>Punto 2</li>
                            <li>Punto 3</li>
                        </ol>
                        
                        <h3>💬 DISCUSIONES</h3>
                        <p><strong>Punto 1:</strong> Discusión sobre el punto 1...</p>
                        <p><strong>Punto 2:</strong> Discusión sobre el punto 2...</p>
                        
                        <h3>✅ ACUERDOS Y CONCLUSIONES</h3>
                        <ul>
                            <li>Acuerdo 1 (Responsable: Nombre, Fecha: Fecha)</li>
                            <li>Acuerdo 2 (Responsable: Nombre, Fecha: Fecha)</li>
                        </ul>
                        
                        <h3>📅 PRÓXIMA REUNIÓN</h3>
                        <p><strong>Fecha propuesta:</strong> Fecha</p>
                        <p><strong>Temas a tratar:</strong> Temas</p>
                        
                        <h3>✍️ FIRMAS</h3>
                        <p>_________________________________</p>
                        <p>Secretario/a</p>
                    `
                };
                
                if (templates[template]) {
                    editor.innerHTML = templates[template];
                    editor.focus();
                    
                    this.showNotification('Plantilla cargada', `Plantilla "${template}" cargada correctamente`, 'success');
                }
            }

            // Obtener rango de la semana
            getWeekRange() {
                const now = new Date();
                const startOfWeek = new Date(now);
                startOfWeek.setDate(now.getDate() - now.getDay());
                
                const endOfWeek = new Date(startOfWeek);
                endOfWeek.setDate(endOfWeek.getDate() + 6);
                
                return `${startOfWeek.toLocaleDateString('es-CR', { day: 'numeric', month: 'short' })} - ${endOfWeek.toLocaleDateString('es-CR', { day: 'numeric', month: 'short', year: 'numeric' })}`;
            }

            // Cargar notas guardadas
            loadSavedNotes() {
                const notesList = document.getElementById('savedNotes');
                if (!notesList) return;
                
                const notes = AppState.data.notes
                    .sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt))
                    .slice(0, 5);
                
                // Limpiar lista
                notesList.innerHTML = '';
                
                if (notes.length === 0) {
                    notesList.innerHTML = `
                        <div class="empty-state" style="padding: var(--space-md);">
                            <i class="fas fa-sticky-note"></i>
                            <div>No hay notas guardadas</div>
                        </div>
                    `;
                    return;
                }
                
                notes.forEach(note => {
                    const noteItem = document.createElement('div');
                    noteItem.className = 'activity-item';
                    
                    // Extraer vista previa del contenido
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = note.content;
                    const preview = tempDiv.textContent.substring(0, 100) + (tempDiv.textContent.length > 100 ? '...' : '');
                    
                    noteItem.innerHTML = `
                        <div class="activity-icon bitacora">
                            <i class="fas fa-sticky-note"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">${note.title}</div>
                            <div class="activity-time">
                                ${preview}
                            </div>
                            <div class="activity-time" style="margin-top: 4px; font-size: 11px;">
                                ${this.formatRelativeTime(new Date(note.updatedAt))}
                            </div>
                        </div>
                        <div class="task-actions">
                            <button class="action-btn load-note" data-id="${note.id}" title="Cargar">
                                <i class="fas fa-arrow-up"></i>
                            </button>
                            <button class="action-btn delete delete-note" data-id="${note.id}" title="Eliminar">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    
                    // Agregar eventos
                    const loadBtn = noteItem.querySelector('.load-note');
                    const deleteBtn = noteItem.querySelector('.delete-note');
                    
                    loadBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.loadNote(note.id);
                    });
                    
                    deleteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.deleteNote(note.id);
                    });
                    
                    // Cargar nota al hacer clic en el item
                    noteItem.addEventListener('click', (e) => {
                        if (!e.target.closest('.task-actions')) {
                            this.loadNote(note.id);
                        }
                    });
                    
                    notesList.appendChild(noteItem);
                });
            }

            // Cargar nota en editor
            loadNote(noteId) {
                const note = AppState.data.notes.find(n => n.id === noteId);
                if (note) {
                    const editor = document.getElementById('editorContent');
                    if (editor) {
                        editor.innerHTML = note.content;
                        editor.focus();
                        
                        this.showNotification('Nota cargada', 'La nota ha sido cargada en el editor', 'success');
                    }
                }
            }

            // Eliminar nota
            async deleteNote(noteId) {
                if (!confirm('¿Está seguro de que desea eliminar esta nota?')) {
                    return;
                }
                
                try {
                    const index = AppState.data.notes.findIndex(n => n.id === noteId);
                    if (index !== -1) {
                        AppState.data.notes.splice(index, 1);
                        
                        await this.saveData();
                        
                        this.showNotification('Nota eliminada', 'La nota ha sido eliminada', 'success');
                        
                        // Recargar lista
                        this.loadSavedNotes();
                    }
                } catch (error) {
                    console.error('❌ Error eliminando nota:', error);
                    this.showNotification('Error', 'No se pudo eliminar la nota', 'error');
                }
            }

            // Cargar datos de bitácora
            loadBitacoraData() {
                // Configurar pestañas
                this.setupBitacoraTabs();
                
                // Cargar notas guardadas
                this.loadSavedNotes();
            }

            // Configurar pestañas de bitácora
            setupBitacoraTabs() {
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const tab = btn.dataset.tab;
                        
                        // Actualizar botones activos
                        document.querySelectorAll('.tab-btn').forEach(b => {
                            b.classList.remove('active');
                        });
                        btn.classList.add('active');
                        
                        // Mostrar contenido de la pestaña
                        document.querySelectorAll('.tab-content').forEach(content => {
                            content.classList.remove('active');
                        });
                        
                        const tabContent = document.getElementById(`${tab}Tab`);
                        if (tabContent) {
                            tabContent.classList.add('active');
                        }
                        
                        // Cargar datos específicos de la pestaña
                        if (tab === 'daily') {
                            // this.loadDailyBitacora();
                        } else if (tab === 'weekly') {
                            // this.loadWeeklyPlan();
                        } else if (tab === 'monthly') {
                            // this.loadMonthlyReport();
                        }
                    });
                });
            }

            // ============================================
            // EVENTOS
            // ============================================

            // Abrir modal de evento
            openEventModal(event = null, date = null) {
                const modal = document.getElementById('eventModal');
                const modalTitle = document.getElementById('eventModalTitle');
                
                if (event) {
                    modalTitle.textContent = 'Editar Evento';
                    
                    // Llenar formulario con datos del evento
                    document.getElementById('eventTitle').value = event.title;
                    document.getElementById('eventDescription').value = event.description || '';
                    document.getElementById('eventType').value = event.type;
                    document.getElementById('eventColor').value = event.color;
                    document.getElementById('eventStart').value = this.formatDateTimeForInput(new Date(event.start));
                    document.getElementById('eventEnd').value = this.formatDateTimeForInput(new Date(event.end));
                    document.getElementById('eventLocation').value = event.location || '';
                    document.getElementById('eventParticipants').value = event.participants || '';
                    document.getElementById('eventReminder').value = event.reminder || 15;
                    
                    // Guardar referencia al evento que se está editando
                    this.editingEventId = event.id;
                } else {
                    modalTitle.textContent = 'Nuevo Evento';
                    
                    // Limpiar formulario
                    document.getElementById('eventForm').reset();
                    
                    // Establecer valores por defecto
                    const now = new Date();
                    const start = date || new Date(now.getTime() + 3600000); // 1 hora desde ahora o fecha proporcionada
                    const end = new Date(start.getTime() + 3600000); // 2 horas desde el inicio
                    
                    document.getElementById('eventStart').value = this.formatDateTimeForInput(start);
                    document.getElementById('eventEnd').value = this.formatDateTimeForInput(end);
                    document.getElementById('eventType').value = 'meeting';
                    document.getElementById('eventColor').value = '#6F42C1';
                    document.getElementById('eventReminder').value = 15;
                    
                    // Limpiar referencia de edición
                    this.editingEventId = null;
                }
                
                // Mostrar modal
                modal.classList.add('active');
                AppState.ui.modals.event = true;
            }

            // Formatear fecha y hora para input datetime-local
            formatDateTimeForInput(date) {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const hours = String(date.getHours()).padStart(2, '0');
                const minutes = String(date.getMinutes()).padStart(2, '0');
                
                return `${year}-${month}-${day}T${hours}:${minutes}`;
            }

            // Guardar evento
            async saveEvent() {
                try {
                    const form = document.getElementById('eventForm');
                    
                    if (!form.checkValidity()) {
                        form.reportValidity();
                        return false;
                    }
                    
                    const eventData = {
                        title: document.getElementById('eventTitle').value.trim(),
                        description: document.getElementById('eventDescription').value.trim(),
                        type: document.getElementById('eventType').value,
                        color: document.getElementById('eventColor').value,
                        start: document.getElementById('eventStart').value,
                        end: document.getElementById('eventEnd').value,
                        location: document.getElementById('eventLocation').value.trim(),
                        participants: document.getElementById('eventParticipants').value.trim(),
                        reminder: parseInt(document.getElementById('eventReminder').value) || 0,
                        updatedAt: new Date().toISOString()
                    };
                    
                    // Validar fechas
                    const startDate = new Date(eventData.start);
                    const endDate = new Date(eventData.end);
                    
                    if (endDate <= startDate) {
                        alert('La fecha de fin debe ser posterior a la fecha de inicio');
                        return false;
                    }
                    
                    if (this.editingEventId) {
                        // Actualizar evento existente
                        const index = AppState.data.events.findIndex(e => e.id === this.editingEventId);
                        if (index !== -1) {
                            AppState.data.events[index] = {
                                ...AppState.data.events[index],
                                ...eventData
                            };
                            
                            this.showNotification('Evento actualizado', 'El evento ha sido actualizado correctamente', 'success');
                        }
                    } else {
                        // Crear nuevo evento
                        const newEvent = {
                            id: 'event-' + Date.now(),
                            ...eventData,
                            createdAt: new Date().toISOString()
                        };
                        
                        AppState.data.events.push(newEvent);
                        this.showNotification('Evento creado', 'El evento ha sido creado correctamente', 'success');
                    }
                    
                    // Guardar datos
                    await this.saveData();
                    
                    // Cerrar modal
                    this.closeEventModal();
                    
                    // Actualizar calendario si está visible
                    if (AppState.currentPage === 'calendar' && this.calendar) {
                        this.loadCalendarData();
                    }
                    
                    // Actualizar dashboard
                    this.updateDashboardStats();
                    this.loadUpcomingEvents();
                    
                    return true;
                } catch (error) {
                    console.error('❌ Error guardando evento:', error);
                    this.showNotification('Error', 'No se pudo guardar el evento', 'error');
                    return false;
                }
            }

            // Cerrar modal de evento
            closeEventModal() {
                const modal = document.getElementById('eventModal');
                modal.classList.remove('active');
                AppState.ui.modals.event = false;
                this.editingEventId = null;
            }

            // ============================================
            // ENLACES
            // ============================================

            // Cargar datos de enlaces
            loadLinksData() {
                this.renderLinks();
                this.setupLinksEvents();
            }

            // Renderizar enlaces
            renderLinks(filter = 'all') {
                const linksGrid = document.getElementById('linksGrid');
                if (!linksGrid) return;
                
                let filteredLinks = [...AppState.data.links];
                
                // Aplicar filtro de categoría si existe
                if (filter !== 'all') {
                    filteredLinks = filteredLinks.filter(link => link.category === filter);
                }
                
                // Ordenar: favoritos primero, luego por fecha
                filteredLinks.sort((a, b) => {
                    if (a.favorite && !b.favorite) return -1;
                    if (!a.favorite && b.favorite) return 1;
                    return new Date(b.createdAt) - new Date(a.createdAt);
                });
                
                // Limpiar grid
                linksGrid.innerHTML = '';
                
                if (filteredLinks.length === 0) {
                    linksGrid.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-link"></i>
                            <div>No hay enlaces guardados</div>
                        </div>
                    `;
                    return;
                }
                
                // Renderizar enlaces
                filteredLinks.forEach(link => {
                    const linkCard = this.createLinkCard(link);
                    linksGrid.appendChild(linkCard);
                });
            }

            // Crear tarjeta de enlace
            createLinkCard(link) {
                const linkCard = document.createElement('a');
                linkCard.className = 'link-card';
                linkCard.href = link.url;
                linkCard.target = '_blank';
                linkCard.title = link.url;
                
                // Extraer dominio para mostrar
                let domain = 'Enlace';
                try {
                    const urlObj = new URL(link.url);
                    domain = urlObj.hostname.replace('www.', '');
                } catch (e) {
                    // Si no es una URL válida, usar el título
                    domain = link.title;
                }
                
                // Obtener emoji para el favicon
                const favicon = this.getFaviconForLink(link);
                
                linkCard.innerHTML = `
                    ${link.favorite ? '<div class="link-qr" title="Favorito"><i class="fas fa-star"></i></div>' : ''}
                    <div class="link-favicon">${favicon}</div>
                    <div class="link-title">${link.title}</div>
                    <div class="link-url">${domain}</div>
                    <div class="link-actions" style="margin-top: 12px;">
                        <button class="btn btn-secondary btn-small copy-link" data-url="${link.url}" title="Copiar enlace">
                            <i class="fas fa-copy"></i>
                        </button>
                        <button class="btn btn-secondary btn-small edit-link" data-id="${link.id}" title="Editar">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger btn-small delete-link" data-id="${link.id}" title="Eliminar">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                // Agregar eventos a los botones (prevenir navegación al hacer clic en botones)
                linkCard.querySelectorAll('button').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        const action = btn.classList.contains('copy-link') ? 'copy' :
                                     btn.classList.contains('edit-link') ? 'edit' :
                                     btn.classList.contains('delete-link') ? 'delete' : null;
                        
                        const linkId = btn.dataset.id;
                        const linkUrl = btn.dataset.url;
                        
                        if (action === 'copy' && linkUrl) {
                            this.copyToClipboard(linkUrl);
                        } else if (action === 'edit' && linkId) {
                            this.editLink(linkId);
                        } else if (action === 'delete' && linkId) {
                            this.deleteLink(linkId);
                        }
                    });
                });
                
                return linkCard;
            }

            // Obtener favicon para enlace
            getFaviconForLink(link) {
                const domainMap = {
                    'mep.go.cr': '🏛️',
                    'outlook.office.com': '📧',
                    'calendar.google.com': '📅',
                    'drive.google.com': '📁',
                    'meet.google.com': '🎥',
                    'docs.google.com': '📄',
                    'github.com': '💻',
                    'teams.microsoft.com': '💬',
                    'youtube.com': '🎬',
                    'symbaloo.com': '🔗',
                    'google.com': '🔍'
                };
                
                try {
                    const urlObj = new URL(link.url);
                    const hostname = urlObj.hostname;
                    
                    for (const [domain, emoji] of Object.entries(domainMap)) {
                        if (hostname.includes(domain)) {
                            return emoji;
                        }
                    }
                    
                    // Emojis por tipo de dominio
                    if (hostname.includes('.go.cr')) return '🇨🇷';
                    if (hostname.includes('.edu.')) return '🎓';
                    if (hostname.includes('drive') || hostname.includes('dropbox')) return '📁';
                    if (hostname.includes('calendar')) return '📅';
                    if (hostname.includes('mail')) return '📧';
                    
                    return '🔗';
                } catch (e) {
                    return '🔗';
                }
            }

            // Configurar eventos de enlaces
            setupLinksEvents() {
                // Botón agregar enlace
                document.getElementById('addLinkBtn')?.addEventListener('click', () => {
                    this.addLink();
                });
                
                // Botón nuevo enlace (modal)
                document.getElementById('newLinkBtn')?.addEventListener('click', () => {
                    this.openLinkModal();
                });
            }

            // Agregar enlace desde formulario rápido
            async addLink() {
                try {
                    const urlInput = document.getElementById('linkUrl');
                    const titleInput = document.getElementById('linkTitle');
                    const categoryInput = document.getElementById('linkCategory');
                    
                    const url = urlInput.value.trim();
                    if (!url) {
                        this.showNotification('Error', 'Por favor, ingresa una URL', 'error');
                        return;
                    }
                    
                    // Validar URL
                    try {
                        new URL(url);
                    } catch (e) {
                        this.showNotification('Error', 'La URL ingresada no es válida', 'error');
                        return;
                    }
                    
                    const linkData = {
                        title: titleInput.value.trim() || this.extractTitleFromUrl(url),
                        url: url,
                        description: '',
                        category: categoryInput.value,
                        tags: [],
                        favorite: false,
                        qrCode: null,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };
                    
                    // Crear nuevo enlace
                    const newLink = {
                        id: 'link-' + Date.now(),
                        ...linkData
                    };
                    
                    AppState.data.links.push(newLink);
                    
                    // Guardar datos
                    await this.saveData();
                    
                    // Limpiar formulario
                    urlInput.value = '';
                    titleInput.value = '';
                    categoryInput.value = 'general';
                    
                    // Recargar enlaces
                    this.renderLinks();
                    
                    this.showNotification('Enlace agregado', 'El enlace ha sido agregado correctamente', 'success');
                    
                } catch (error) {
                    console.error('❌ Error agregando enlace:', error);
                    this.showNotification('Error', 'No se pudo agregar el enlace', 'error');
                }
            }

            // Extraer título de URL
            extractTitleFromUrl(url) {
                try {
                    const urlObj = new URL(url);
                    let title = urlObj.hostname.replace('www.', '');
                    
                    // Capitalizar primera letra
                    title = title.charAt(0).toUpperCase() + title.slice(1);
                    
                    return title;
                } catch (e) {
                    return 'Nuevo Enlace';
                }
            }

            // Abrir modal de enlace
            openLinkModal(link = null) {
                const modal = document.getElementById('linkModal');
                
                if (link) {
                    // Llenar formulario con datos del enlace
                    document.getElementById('modalLinkUrl').value = link.url;
                    document.getElementById('modalLinkTitle').value = link.title;
                    document.getElementById('modalLinkDescription').value = link.description || '';
                    document.getElementById('modalLinkCategory').value = link.category || 'general';
                    document.getElementById('modalLinkTags').value = link.tags?.join(', ') || '';
                    document.getElementById('modalLinkFavorite').checked = link.favorite || false;
                    
                    // Guardar referencia al enlace que se está editando
                    this.editingLinkId = link.id;
                } else {
                    // Limpiar formulario
                    document.getElementById('linkForm').reset();
                    
                    // Limpiar referencia de edición
                    this.editingLinkId = null;
                }
                
                // Mostrar modal
                modal.classList.add('active');
                AppState.ui.modals.link = true;
            }

            // Editar enlace
            editLink(linkId) {
                const link = AppState.data.links.find(l => l.id === linkId);
                if (link) {
                    this.openLinkModal(link);
                }
            }

            // Guardar enlace desde modal
            async saveLinkFromModal() {
                try {
                    const form = document.getElementById('linkForm');
                    
                    if (!form.checkValidity()) {
                        form.reportValidity();
                        return false;
                    }
                    
                    const linkData = {
                        url: document.getElementById('modalLinkUrl').value.trim(),
                        title: document.getElementById('modalLinkTitle').value.trim() || this.extractTitleFromUrl(document.getElementById('modalLinkUrl').value),
                        description: document.getElementById('modalLinkDescription').value.trim(),
                        category: document.getElementById('modalLinkCategory').value,
                        tags: document.getElementById('modalLinkTags').value.split(',').map(tag => tag.trim()).filter(tag => tag),
                        favorite: document.getElementById('modalLinkFavorite').checked,
                        qrCode: document.getElementById('modalLinkGenerateQR').checked ? this.generateQRCodeData(document.getElementById('modalLinkUrl').value) : null,
                        updatedAt: new Date().toISOString()
                    };
                    
                    // Validar URL
                    try {
                        new URL(linkData.url);
                    } catch (e) {
                        alert('La URL ingresada no es válida');
                        return false;
                    }
                    
                    if (this.editingLinkId) {
                        // Actualizar enlace existente
                        const index = AppState.data.links.findIndex(l => l.id === this.editingLinkId);
                        if (index !== -1) {
                            AppState.data.links[index] = {
                                ...AppState.data.links[index],
                                ...linkData
                            };
                            
                            this.showNotification('Enlace actualizado', 'El enlace ha sido actualizado', 'success');
                        }
                    } else {
                        // Crear nuevo enlace
                        const newLink = {
                            id: 'link-' + Date.now(),
                            ...linkData,
                            createdAt: new Date().toISOString()
                        };
                        
                        AppState.data.links.push(newLink);
                        this.showNotification('Enlace creado', 'El enlace ha sido creado', 'success');
                    }
                    
                    // Guardar datos
                    await this.saveData();
                    
                    // Cerrar modal
                    this.closeLinkModal();
                    
                    // Recargar enlaces
                    this.renderLinks();
                    
                    return true;
                } catch (error) {
                    console.error('❌ Error guardando enlace:', error);
                    this.showNotification('Error', 'No se pudo guardar el enlace', 'error');
                    return false;
                }
            }

            // Generar código QR (simulado)
            generateQRCodeData(url) {
                // En una implementación real, aquí se generaría un código QR
                // Por simplicidad, retornamos un objeto con datos simulados
                return {
                    data: `QR_CODE_FOR:${url}`,
                    generatedAt: new Date().toISOString()
                };
            }

            // Eliminar enlace
            async deleteLink(linkId) {
                if (!confirm('¿Está seguro de que desea eliminar este enlace?')) {
                    return;
                }
                
                try {
                    const index = AppState.data.links.findIndex(l => l.id === linkId);
                    if (index !== -1) {
                        AppState.data.links.splice(index, 1);
                        
                        await this.saveData();
                        
                        this.showNotification('Enlace eliminado', 'El enlace ha sido eliminado', 'success');
                        
                        // Recargar enlaces
                        this.renderLinks();
                        
                        // Actualizar badge
                        this.updateBadges();
                    }
                } catch (error) {
                    console.error('❌ Error eliminando enlace:', error);
                    this.showNotification('Error', 'No se pudo eliminar el enlace', 'error');
                }
            }

            // Cerrar modal de enlace
            closeLinkModal() {
                const modal = document.getElementById('linkModal');
                modal.classList.remove('active');
                AppState.ui.modals.link = false;
                this.editingLinkId = null;
            }

            // Copiar al portapapeles
            copyToClipboard(text) {
                navigator.clipboard.writeText(text).then(() => {
                    this.showNotification('Copiado', 'Enlace copiado al portapapeles', 'success', 2000);
                }).catch(err => {
                    console.error('❌ Error copiando al portapapeles:', err);
                    this.showNotification('Error', 'No se pudo copiar el enlace', 'error');
                });
            }

            // ============================================
            // INTEGRACIONES
            // ============================================

            // Cargar datos de integraciones
            loadIntegrationsData() {
                this.setupIntegrationsEvents();
            }

            // Configurar eventos de integraciones
            setupIntegrationsEvents() {
                // YouTube
                document.getElementById('searchYouTubeBtn')?.addEventListener('click', () => {
                    this.searchYouTube();
                });
                
                document.getElementById('openYouTubeBtn')?.addEventListener('click', () => {
                    window.open('https://www.youtube.com', '_blank');
                });
                
                // Correo MEP
                document.getElementById('checkMailBtn')?.addEventListener('click', () => {
                    this.checkMail();
                });
                
                document.getElementById('composeMailBtn')?.addEventListener('click', () => {
                    this.composeMail();
                });
                
                // Symbaloo
                document.getElementById('connectSymbalooBtn')?.addEventListener('click', () => {
                    this.connectSymbaloo();
                });
                
                document.getElementById('openSymbalooBtn')?.addEventListener('click', () => {
                    window.open('https://www.symbaloo.com/home/mix/13eP7Bh97Y', '_blank');
                });
            }

            // Buscar en YouTube (simulado)
            searchYouTube() {
                this.showNotification('Búsqueda YouTube', 'Buscando videos educativos...', 'info');
                
                // Simular búsqueda
                setTimeout(() => {
                    const youtubePlayer = document.getElementById('youtubePlayer');
                    if (youtubePlayer) {
                        youtubePlayer.innerHTML = `
                            <div style="padding: var(--space-lg); text-align: center;">
                                <i class="fab fa-youtube" style="font-size: 48px; color: #FF0000; margin-bottom: var(--space-md);"></i>
                                <div style="font-weight: 600; margin-bottom: var(--space-sm);">Videos Educativos MEP</div>
                                <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: var(--space-lg);">
                                    Tutoriales y recursos educativos disponibles
                                </div>
                                <div style="display: flex; flex-direction: column; gap: var(--space-sm);">
                                    <button class="btn btn-secondary" onclick="mepSystem.playYouTubeVideo('tutorial-mep-1')">
                                        <i class="fas fa-play"></i> Tutorial MEP Básico
                                    </button>
                                    <button class="btn btn-secondary" onclick="mepSystem.playYouTubeVideo('recursos-digitales')">
                                        <i class="fas fa-play"></i> Recursos Digitales
                                    </button>
                                    <button class="btn btn-secondary" onclick="mepSystem.playYouTubeVideo('capacitacion-docente')">
                                        <i class="fas fa-play"></i> Capacitación Docente
                                    </button>
                                </div>
                            </div>
                        `;
                    }
                }, 1000);
            }

            // Reproducir video de YouTube (simulado)
            playYouTubeVideo(videoId) {
                this.showNotification('Reproduciendo', `Iniciando video: ${videoId}`, 'info');
                
                // En una implementación real, aquí se integraría el reproductor de YouTube
                const youtubePlayer = document.getElementById('youtubePlayer');
                if (youtubePlayer) {
                    youtubePlayer.innerHTML = `
                        <div style="padding: var(--space-lg); text-align: center;">
                            <div style="font-size: 48px; margin-bottom: var(--space-md);">🎬</div>
                            <div style="font-weight: 600; margin-bottom: var(--space-sm);">Reproduciendo video educativo</div>
                            <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: var(--space-lg);">
                                Video: ${videoId}
                            </div>
                            <div style="background: var(--bg-hover); padding: var(--space-md); border-radius: var(--radius-md); margin-bottom: var(--space-md);">
                                <div style="display: flex; align-items: center; justify-content: center; gap: var(--space-md);">
                                    <button class="btn btn-icon" onclick="mepSystem.pauseYouTubeVideo()">
                                        <i class="fas fa-pause"></i>
                                    </button>
                                    <button class="btn btn-icon" onclick="mepSystem.stopYouTubeVideo()">
                                        <i class="fas fa-stop"></i>
                                    </button>
                                </div>
                            </div>
                            <button class="btn btn-secondary" onclick="mepSystem.searchYouTube()">
                                <i class="fas fa-arrow-left"></i> Volver a la búsqueda
                            </button>
                        </div>
                    `;
                }
            }

            // Pausar video (simulado)
            pauseYouTubeVideo() {
                this.showNotification('Video pausado', 'El video se ha pausado', 'info');
            }

            // Detener video (simulado)
            stopYouTubeVideo() {
                this.searchYouTube(); // Volver a la búsqueda
            }

            // Revisar correo (simulado)
            checkMail() {
                this.showNotification('Revisando correo', 'Buscando nuevos mensajes...', 'info');
                
                // Simular revisión de correo
                setTimeout(() => {
                    this.showNotification('Correo revisado', 'Tienes 3 nuevos mensajes', 'success');
                }, 1500);
            }

            // Redactar correo (simulado)
            composeMail() {
                this.showNotification('Redactar correo', 'Abriendo editor de correo...', 'info');
                
                // Simular apertura de editor de correo
                setTimeout(() => {
                    window.open('https://outlook.office.com/mail/deeplink/compose', '_blank');
                }, 1000);
            }

            // Conectar Symbaloo (simulado)
            connectSymbaloo() {
                this.showNotification('Conectando Symbaloo', 'Estableciendo conexión...', 'info');
                
                // Simular conexión
                setTimeout(() => {
                    const statusElement = document.querySelector('.integration-card .integration-status');
                    if (statusElement) {
                        statusElement.textContent = 'Conectado';
                        statusElement.classList.add('connected');
                    }
                    
                    this.showNotification('Symbaloo conectado', 'Conexión establecida correctamente', 'success');
                }, 2000);
            }

            // ============================================
            // ASISTENTE IA
            // ============================================

            // Cargar datos del asistente
            loadAssistantData() {
                this.setupAssistantEvents();
            }

            // Configurar eventos del asistente
            setupAssistantEvents() {
                // Selector de motor de IA
                document.querySelectorAll('.engine-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const engine = btn.dataset.engine;
                        
                        // Actualizar botones activos
                        document.querySelectorAll('.engine-btn').forEach(b => {
                            b.classList.remove('active');
                        });
                        btn.classList.add('active');
                        
                        this.showNotification(
                            'Motor cambiado',
                            `Ahora usando: ${this.getAIEngineName(engine)}`,
                            'info',
                            2000
                        );
                    });
                });
                
                // Comandos rápidos
                document.querySelectorAll('.command-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const command = btn.dataset.command;
                        this.processAssistantCommand(command);
                    });
                });
                
                // Formulario de chat
                const chatForm = document.getElementById('chatForm');
                const chatInput = document.getElementById('chatInput');
                
                if (chatForm && chatInput) {
                    chatForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        
                        const message = chatInput.value.trim();
                        if (message) {
                            this.sendChatMessage(message);
                            chatInput.value = '';
                            
                            // Ajustar altura del textarea
                            chatInput.style.height = 'auto';
                        }
                    });
                    
                    // Auto-ajustar altura del textarea
                    chatInput.addEventListener('input', function() {
                        this.style.height = 'auto';
                        this.style.height = Math.min(this.scrollHeight, 120) + 'px';
                    });
                }
            }

            // Obtener nombre del motor de IA
            getAIEngineName(engine) {
                const names = {
                    'deepseek': 'DeepSeek',
                    'gemini': 'Google Gemini',
                    'copilot': 'Microsoft Copilot',
                    'chatgpt': 'ChatGPT',
                    'local': 'IA Local'
                };
                
                return names[engine] || engine;
            }

            // Procesar comando del asistente
            processAssistantCommand(command) {
                const commands = {
                    'tasks-today': '¿Qué tareas tengo para hoy?',
                    'events-week': 'Muéstrame los eventos de esta semana',
                    'generate-report': 'Genera un informe semanal de actividades',
                    'productivity-stats': 'Muéstrame mis estadísticas de productividad',
                    'help-links': '¿Qué enlaces útiles recomiendas para el MEP?',
                    'format-document': 'Ayúdame a formatear un documento',
                    'translate-text': 'Traduce este texto al inglés',
                    'summarize': 'Resume este texto largo'
                };
                
                const message = commands[command];
                if (message) {
                    const chatInput = document.getElementById('chatInput');
                    if (chatInput) {
                        chatInput.value = message;
                        chatInput.focus();
                        
                        // Disparar evento de submit
                        document.getElementById('chatForm').dispatchEvent(new Event('submit'));
                    }
                }
            }

            // Enviar mensaje de chat
            async sendChatMessage(message) {
                // Agregar mensaje del usuario
                this.addChatMessage(message, 'user');
                
                // Mostrar indicador de "escribiendo"
                const thinkingMessage = this.addChatMessage('Pensando...', 'assistant', 'thinking');
                
                // Obtener motor de IA seleccionado
                const selectedEngine = document.querySelector('.engine-btn.active')?.dataset.engine || 'deepseek';
                
                // Simular procesamiento con IA
                setTimeout(() => {
                    // Eliminar indicador de "escribiendo"
                    const chatMessages = document.getElementById('chatMessages');
                    if (thinkingMessage && chatMessages.contains(thinkingMessage)) {
                        chatMessages.removeChild(thinkingMessage);
                    }
                    
                    // Generar respuesta
                    const response = this.generateAIResponse(message, selectedEngine);
                    
                    // Agregar respuesta
                    this.addChatMessage(response, 'assistant');
                }, 1500);
            }

            // Agregar mensaje al chat
            addChatMessage(message, sender, type = 'normal') {
                const chatMessages = document.getElementById('chatMessages');
                if (!chatMessages) return null;
                
                const messageElement = document.createElement('div');
                messageElement.className = `message ${sender} ${type === 'thinking' ? 'thinking' : ''}`;
                messageElement.textContent = message;
                
                chatMessages.appendChild(messageElement);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                return messageElement;
            }

            // Generar respuesta de IA
            generateAIResponse(message, engine) {
                const messageLower = message.toLowerCase();
                
                // Respuestas según el motor de IA
                const engineResponses = {
                    'deepseek': 'Basado en mi análisis de DeepSeek: ',
                    'gemini': 'Según Google Gemini: ',
                    'copilot': 'Microsoft Copilot sugiere: ',
                    'chatgpt': 'OpenAI ChatGPT recomienda: ',
                    'local': 'Mi análisis local indica: '
                };
                
                let enginePrefix = engineResponses[engine] || '';
                
                // Generar respuesta según el contenido del mensaje
                if (messageLower.includes('tarea') || messageLower.includes('qué tengo que hacer')) {
                    const pendingTasks = AppState.data.tasks.filter(t => t.status !== 'completed').length;
                    const todayTasks = AppState.data.tasks.filter(t => {
                        if (t.status !== 'completed' && t.dueDate) {
                            const dueDate = new Date(t.dueDate);
                            const today = new Date();
                            return dueDate.toDateString() === today.toDateString();
                        }
                        return false;
                    });
                    
                    if (todayTasks.length > 0) {
                        return `${enginePrefix}Hoy tienes ${todayTasks.length} tareas pendientes. Las más importantes son: ${todayTasks.slice(0, 3).map(t => t.title).join(', ')}. Te recomiendo priorizar las tareas con alta prioridad.`;
                    } else {
                        return `${enginePrefix}Hoy no tienes tareas pendientes. ¡Excelente trabajo! Puedes revisar las tareas futuras o crear nuevas tareas.`;
                    }
                }
                else if (messageLower.includes('evento') || messageLower.includes('reunión')) {
                    const today = new Date().toISOString().split('T')[0];
                    const todayEvents = AppState.data.events.filter(e => 
                        new Date(e.start).toISOString().split('T')[0] === today
                    );
                    
                    if (todayEvents.length > 0) {
                        const eventsList = todayEvents.map(e => `${e.title} a las ${new Date(e.start).toLocaleTimeString('es-CR', { hour: '2-digit', minute: '2-digit' })}`).join(', ');
                        return `${enginePrefix}Hoy tienes ${todayEvents.length} eventos: ${eventsList}. Recuerda prepararte para las reuniones importantes.`;
                    } else {
                        return `${enginePrefix}Hoy no tienes eventos programados. Es un buen día para enfocarte en tareas importantes.`;
                    }
                }
                else if (messageLower.includes('informe') || messageLower.includes('reporte')) {
                    return `${enginePrefix}Puedo ayudarte a generar informes diarios, semanales o mensuales. Ve a la sección "Informes" y selecciona el período que necesitas. También puedo ayudarte a redactar informes si me proporcionas los datos.`;
                }
                else if (messageLower.includes('enlace') || messageLower.includes('recomienda') || messageLower.includes('útil')) {
                    const usefulLinks = AppState.data.links.filter(l => l.favorite || l.category === 'mep').slice(0, 3);
                    if (usefulLinks.length > 0) {
                        const linksList = usefulLinks.map(l => l.title).join(', ');
                        return `${enginePrefix}Para el trabajo en el MEP, te recomiendo estos enlaces: ${linksList}. También puedes consultar el portal oficial del MEP y Symbaloo para recursos educativos.`;
                    } else {
                        return `${enginePrefix}Te recomiendo visitar el portal oficial del MEP (https://www.mep.go.cr) y Symbaloo para recursos educativos organizados.`;
                    }
                }
                else if (messageLower.includes('hola') || messageLower.includes('buenos días') || messageLower.includes('buenas tardes')) {
                    return `${enginePrefix}¡Hola! Soy tu asistente virtual del MEP. Estoy aquí para ayudarte con la gestión de tareas, eventos, informes y más. ¿En qué puedo asistirte hoy?`;
                }
                else if (messageLower.includes('gracias') || messageLower.includes('thank you')) {
                    return `${enginePrefix}¡De nada! Estoy aquí para ayudarte. Si necesitas algo más, no dudes en preguntar.`;
                }
                else {
                    // Respuesta genérica
                    const genericResponses = [
                        `${enginePrefix}Entiendo que preguntas sobre "${message}". Puedo ayudarte mejor si eres más específico. Por ejemplo, puedes preguntar sobre tus tareas, eventos, o pedirme que genere un informe.`,
                        `${enginePrefix}Interesante pregunta. Como asistente del MEP, puedo ayudarte con gestión de tareas, calendario, informes y recursos educativos. ¿En qué área necesitas ayuda?`,
                        `${enginePrefix}Necesito más contexto para ayudarte mejor. ¿Podrías reformular tu pregunta o ser más específico sobre lo que necesitas?`,
                        `${enginePrefix}Estoy diseñado para asistirte en labores del MEP. Puedo ayudarte con organización, generación de informes, recordatorios y acceso a recursos. ¿Qué necesitas exactamente?`
                    ];
                    
                    return genericResponses[Math.floor(Math.random() * genericResponses.length)];
                }
            }

            // ============================================
            // INFORMES
            // ============================================

            // Cargar datos de informes
            loadReportsData() {
                this.setupReportsEvents();
                this.loadReportData('daily');
            }

            // Configurar eventos de informes
            setupReportsEvents() {
                // Selector de período
                document.querySelectorAll('.period-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const period = btn.dataset.period;
                        
                        // Actualizar botones activos
                        document.querySelectorAll('.period-btn').forEach(b => {
                            b.classList.remove('active');
                        });
                        btn.classList.add('active');
                        
                        // Cargar datos del período
                        this.loadReportData(period);
                    });
                });
                
                // Botón generar informe
                document.getElementById('generateReportBtn')?.addEventListener('click', () => {
                    this.openReportModal();
                });
                
                // Botones de exportación
                document.getElementById('exportPdfBtn')?.addEventListener('click', () => {
                    this.exportReport('pdf');
                });
                
                document.getElementById('exportWordBtn')?.addEventListener('click', () => {
                    this.exportReport('word');
                });
                
                document.getElementById('exportExcelBtn')?.addEventListener('click', () => {
                    this.exportReport('excel');
                });
                
                document.getElementById('exportHtmlBtn')?.addEventListener('click', () => {
                    this.exportReport('html');
                });
            }

            // Cargar datos del informe
            loadReportData(period) {
                // Actualizar título y período
                const periodTitles = {
                    'daily': 'Informe Diario',
                    'weekly': 'Informe Semanal',
                    'biweekly': 'Informe Quincenal',
                    'monthly': 'Informe Mensual',
                    'annual': 'Informe Anual'
                };
                
                const periodLabels = {
                    'daily': this.getCurrentDateString(),
                    'weekly': this.getWeekRange(),
                    'biweekly': this.getBiweeklyRange(),
                    'monthly': this.getCurrentMonthString(),
                    'annual': new Date().getFullYear().toString()
                };
                
                document.getElementById('reportTitle').textContent = periodTitles[period] || 'Informe';
                document.getElementById('reportPeriod').textContent = periodLabels[period] || '';
                
                // Calcular estadísticas según el período
                const stats = this.calculateReportStats(period);
                
                // Actualizar estadísticas
                document.getElementById('reportHours').textContent = stats.hours.toFixed(1);
                document.getElementById('reportTasks').textContent = stats.tasks;
                document.getElementById('reportMeetings').textContent = stats.meetings;
                document.getElementById('reportProductivity').textContent = `${stats.productivity}%`;
                
                // Cargar actividades
                this.loadReportActivities(period);
            }

            // Obtener fecha actual formateada
            getCurrentDateString() {
                return new Date().toLocaleDateString('es-CR', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }

            // Obtener rango quincenal
            getBiweeklyRange() {
                const now = new Date();
                const day = now.getDate();
                
                let start, end;
                
                if (day <= 15) {
                    // Primera quincena
                    start = new Date(now.getFullYear(), now.getMonth(), 1);
                    end = new Date(now.getFullYear(), now.getMonth(), 15);
                } else {
                    // Segunda quincena
                    start = new Date(now.getFullYear(), now.getMonth(), 16);
                    end = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                }
                
                return `${start.toLocaleDateString('es-CR', { day: 'numeric', month: 'short' })} - ${end.toLocaleDateString('es-CR', { day: 'numeric', month: 'short', year: 'numeric' })}`;
            }

            // Obtener mes actual formateado
            getCurrentMonthString() {
                return new Date().toLocaleDateString('es-CR', {
                    month: 'long',
                    year: 'numeric'
                });
            }

            // Calcular estadísticas del informe
            calculateReportStats(period) {
                const now = new Date();
                let startDate, endDate;
                
                // Definir rango según el período
                switch (period) {
                    case 'daily':
                        startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                        endDate = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
                        break;
                    case 'weekly':
                        startDate = new Date(now);
                        startDate.setDate(now.getDate() - now.getDay());
                        endDate = new Date(startDate);
                        endDate.setDate(startDate.getDate() + 7);
                        break;
                    case 'biweekly':
                        const day = now.getDate();
                        if (day <= 15) {
                            startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                            endDate = new Date(now.getFullYear(), now.getMonth(), 16);
                        } else {
                            startDate = new Date(now.getFullYear(), now.getMonth(), 16);
                            endDate = new Date(now.getFullYear(), now.getMonth() + 1, 1);
                        }
                        break;
                    case 'monthly':
                        startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                        endDate = new Date(now.getFullYear(), now.getMonth() + 1, 1);
                        break;
                    case 'annual':
                        startDate = new Date(now.getFullYear(), 0, 1);
                        endDate = new Date(now.getFullYear() + 1, 0, 1);
                        break;
                    default:
                        startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                        endDate = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
                }
                
                // Filtrar datos dentro del rango
                const tasksInPeriod = AppState.data.tasks.filter(task => {
                    if (!task.dueDate) return false;
                    const taskDate = new Date(task.dueDate);
                    return taskDate >= startDate && taskDate < endDate && task.status === 'completed';
                });
                
                const eventsInPeriod = AppState.data.events.filter(event => {
                    const eventDate = new Date(event.start);
                    return eventDate >= startDate && eventDate < endDate;
                });
                
                const bitacorasInPeriod = AppState.data.bitacoras.filter(bitacora => {
                    const bitacoraDate = new Date(bitacora.date);
                    return bitacoraDate >= startDate && bitacoraDate < endDate;
                });
                
                // Calcular horas trabajadas
                const hours = bitacorasInPeriod.reduce((total, b) => total + (b.hours || 0), 0);
                
                // Calcular productividad (tareas completadas / total tareas en el período)
                const totalTasksInPeriod = AppState.data.tasks.filter(task => {
                    if (!task.dueDate) return false;
                    const taskDate = new Date(task.dueDate);
                    return taskDate >= startDate && taskDate < endDate;
                }).length;
                
                const productivity = totalTasksInPeriod > 0 ? 
                    Math.round((tasksInPeriod.length / totalTasksInPeriod) * 100) : 0;
                
                return {
                    hours: hours,
                    tasks: tasksInPeriod.length,
                    meetings: eventsInPeriod.filter(e => e.type === 'meeting').length,
                    productivity: productivity
                };
            }

            // Cargar actividades del informe
            loadReportActivities(period) {
                const activitiesList = document.getElementById('reportActivities');
                if (!activitiesList) return;
                
                // Limpiar lista
                activitiesList.innerHTML = '';
                
                // Obtener actividades según el período
                const now = new Date();
                let activities = [];
                
                // Agregar tareas completadas
                AppState.data.tasks
                    .filter(task => task.status === 'completed')
                    .slice(0, 5)
                    .forEach(task => {
                        activities.push({
                            type: 'task',
                            title: task.title,
                            description: `Tarea completada - Prioridad: ${this.getPriorityLabel(task.priority)}`,
                            time: task.updatedAt
                        });
                    });
                
                // Agregar eventos recientes
                AppState.data.events
                    .slice(0, 3)
                    .forEach(event => {
                        activities.push({
                            type: 'event',
                            title: event.title,
                            description: `Evento ${this.getEventTypeLabel(event.type)}`,
                            time: event.start
                        });
                    });
                
                // Agregar bitácoras recientes
                AppState.data.bitacoras
                    .slice(0, 2)
                    .forEach(bitacora => {
                        activities.push({
                            type: 'bitacora',
                            title: `Bitácora ${new Date(bitacora.date).toLocaleDateString('es-CR')}`,
                            description: `${bitacora.hours} horas - ${bitacora.modality || 'No especificado'}`,
                            time: bitacora.createdAt
                        });
                    });
                
                // Ordenar por fecha
                activities.sort((a, b) => new Date(b.time) - new Date(a.time));
                
                // Mostrar actividades
                if (activities.length === 0) {
                    activitiesList.innerHTML = `
                        <div class="empty-state" style="padding: var(--space-md);">
                            <i class="fas fa-clipboard-list"></i>
                            <div>No hay actividades para mostrar</div>
                        </div>
                    `;
                    return;
                }
                
                activities.forEach(activity => {
                    const activityItem = document.createElement('div');
                    activityItem.className = 'activity-item';
                    
                    let iconClass = '';
                    let icon = '';
                    
                    switch(activity.type) {
                        case 'task':
                            iconClass = 'task';
                            icon = 'fas fa-tasks';
                            break;
                        case 'event':
                            iconClass = 'event';
                            icon = 'fas fa-calendar';
                            break;
                        case 'bitacora':
                            iconClass = 'bitacora';
                            icon = 'fas fa-book';
                            break;
                    }
                    
                    activityItem.innerHTML = `
                        <div class="activity-icon ${iconClass}">
                            <i class="${icon}"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">${activity.title}</div>
                            <div class="activity-time">
                                ${activity.description} • ${this.formatRelativeTime(new Date(activity.time))}
                            </div>
                        </div>
                    `;
                    
                    activitiesList.appendChild(activityItem);
                });
            }

            // Abrir modal de informe
            openReportModal() {
                const modal = document.getElementById('reportModal');
                
                // Establecer fechas por defecto
                const now = new Date();
                const startDate = new Date(now);
                startDate.setDate(now.getDate() - 7); // Hace una semana
                
                document.getElementById('reportStartDate').value = startDate.toISOString().split('T')[0];
                document.getElementById('reportEndDate').value = now.toISOString().split('T')[0];
                
                // Mostrar modal
                modal.classList.add('active');
                AppState.ui.modals.report = true;
            }

            // Exportar informe
            exportReport(format) {
                const reportTitle = document.getElementById('reportTitle').textContent;
                const reportPeriod = document.getElementById('reportPeriod').textContent;
                
                let message = '';
                
                switch(format) {
                    case 'pdf':
                        message = `Generando PDF: ${reportTitle} - ${reportPeriod}`;
                        break;
                    case 'word':
                        message = `Generando documento Word: ${reportTitle} - ${reportPeriod}`;
                        break;
                    case 'excel':
                        message = `Generando archivo Excel: ${reportTitle} - ${reportPeriod}`;
                        break;
                    case 'html':
                        message = `Generando HTML: ${reportTitle} - ${reportPeriod}`;
                        break;
                    default:
                        message = `Exportando informe: ${reportTitle}`;
                }
                
                this.showNotification('Exportando informe', message, 'info');
                
                // Simular exportación
                setTimeout(() => {
                    this.showNotification('Exportación completa', `El informe se ha exportado como ${format.toUpperCase()}`, 'success');
                }, 2000);
            }

            // Cerrar modal de informe
            closeReportModal() {
                const modal = document.getElementById('reportModal');
                modal.classList.remove('active');
                AppState.ui.modals.report = false;
            }

            // ============================================
            // CONFIGURACIÓN
            // ============================================

            // Cargar datos de configuración
            loadSettingsData() {
                this.loadSettingsForm();
                this.setupSettingsEvents();
            }

            // Cargar formulario de configuración
            loadSettingsForm() {
                // Perfil de usuario
                document.getElementById('userFullName').value = AppState.currentUser.name;
                document.getElementById('userEmail').value = AppState.currentUser.email || '';
                document.getElementById('userDepartment').value = AppState.currentUser.department || 'drte';
                document.getElementById('userRole').value = AppState.currentUser.role;
                
                // Preferencias
                document.getElementById('themeSelect').value = AppState.settings.theme;
                document.getElementById('languageSelect').value = AppState.settings.language;
                document.getElementById('dateFormatSelect').value = AppState.settings.dateFormat;
                document.getElementById('timezoneSelect').value = AppState.settings.timezone;
                
                // Notificaciones
                document.getElementById('notifyTasks').checked = AppState.settings.notifications.tasks;
                document.getElementById('notifyEvents').checked = AppState.settings.notifications.events;
                document.getElementById('notifyReports').checked = AppState.settings.notifications.reports;
                document.getElementById('emailNotifications').checked = AppState.settings.notifications.email;
                
                // Seguridad y backup
                document.getElementById('autosaveFrequency').value = AppState.settings.autosaveFrequency;
                document.getElementById('encryptData').checked = AppState.settings.encryptData;
            }

            // Configurar eventos de configuración
            setupSettingsEvents() {
                // Guardar configuración
                document.getElementById('saveSettingsBtn')?.addEventListener('click', () => {
                    this.saveSettings();
                });
                
                // Restaurar valores por defecto
                document.getElementById('resetSettingsBtn')?.addEventListener('click', () => {
                    this.resetSettings();
                });
                
                // Exportar datos
                document.getElementById('exportDataBtn')?.addEventListener('click', () => {
                    this.exportData();
                });
                
                // Importar datos
                document.getElementById('importDataBtn')?.addEventListener('click', () => {
                    this.triggerImportData();
                });
                
                // Backup ahora
                document.getElementById('backupNowBtn')?.addEventListener('click', () => {
                    this.createBackup();
                    this.showNotification('Backup creado', 'Se ha creado una copia de seguridad', 'success');
                });
            }

            // Guardar configuración
            async saveSettings() {
                try {
                    // Perfil de usuario
                    AppState.currentUser.name = document.getElementById('userFullName').value.trim() || AppState.currentUser.name;
                    AppState.currentUser.email = document.getElementById('userEmail').value.trim();
                    AppState.currentUser.department = document.getElementById('userDepartment').value;
                    
                    // Preferencias
                    AppState.settings.theme = document.getElementById('themeSelect').value;
                    AppState.settings.language = document.getElementById('languageSelect').value;
                    AppState.settings.dateFormat = document.getElementById('dateFormatSelect').value;
                    AppState.settings.timezone = document.getElementById('timezoneSelect').value;
                    
                    // Notificaciones
                    AppState.settings.notifications.tasks = document.getElementById('notifyTasks').checked;
                    AppState.settings.notifications.events = document.getElementById('notifyEvents').checked;
                    AppState.settings.notifications.reports = document.getElementById('notifyReports').checked;
                    AppState.settings.notifications.email = document.getElementById('emailNotifications').checked;
                    
                    // Seguridad y backup
                    AppState.settings.autosaveFrequency = parseInt(document.getElementById('autosaveFrequency').value) || 5;
                    AppState.settings.encryptData = document.getElementById('encryptData').checked;
                    
                    // Guardar datos
                    await this.saveData();
                    
                    // Aplicar cambios
                    this.applySettings();
                    
                    this.showNotification('Configuración guardada', 'Los cambios se han guardado correctamente', 'success');
                    
                    return true;
                } catch (error) {
                    console.error('❌ Error guardando configuración:', error);
                    this.showNotification('Error', 'No se pudo guardar la configuración', 'error');
                    return false;
                }
            }

            // Restaurar configuración por defecto
            resetSettings() {
                if (!confirm('¿Está seguro de que desea restaurar la configuración por defecto? Se perderán los cambios no guardados.')) {
                    return;
                }
                
                // Restaurar valores por defecto
                AppState.settings = {
                    theme: 'light',
                    language: 'es',
                    dateFormat: 'dd/mm/yyyy',
                    timezone: 'America/Costa_Rica',
                    notifications: {
                        tasks: true,
                        events: true,
                        reports: false,
                        email: true
                    },
                    autosave: true,
                    autosaveFrequency: 5,
                    encryptData: true
                };
                
                // Recargar formulario
                this.loadSettingsForm();
                
                // Aplicar cambios
                this.applySettings();
                
                this.showNotification('Configuración restaurada', 'Se han restaurado los valores por defecto', 'success');
            }

            // Disparar importación de datos
            triggerImportData() {
                // Crear input de archivo temporal
                const fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.accept = '.json';
                fileInput.style.display = 'none';
                
                fileInput.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        this.importData(file);
                    }
                });
                
                document.body.appendChild(fileInput);
                fileInput.click();
                document.body.removeChild(fileInput);
            }

            // ============================================
            // SISTEMA DE NOTIFICACIONES
            // ============================================

            // Mostrar notificación
            showNotification(title, message, type = 'info', duration = 5000) {
                const notificationContainer = document.getElementById('notificationContainer');
                if (!notificationContainer) return;
                
                // Crear notificación
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                
                // Icono según tipo
                let icon = 'fas fa-info-circle';
                switch(type) {
                    case 'success':
                        icon = 'fas fa-check-circle';
                        break;
                    case 'error':
                        icon = 'fas fa-exclamation-circle';
                        break;
                    case 'warning':
                        icon = 'fas fa-exclamation-triangle';
                        break;
                }
                
                notification.innerHTML = `
                    <div class="notification-icon">
                        <i class="${icon}"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">${title}</div>
                        <div class="notification-message">${message}</div>
                    </div>
                    <button class="notification-close">&times;</button>
                `;
                
                // Agregar a contenedor
                notificationContainer.appendChild(notification);
                
                // Configurar botón de cierre
                const closeBtn = notification.querySelector('.notification-close');
                closeBtn.addEventListener('click', () => {
                    this.hideNotification(notification);
                });
                
                // Auto-ocultar después de la duración
                if (duration > 0) {
                    setTimeout(() => {
                        this.hideNotification(notification);
                    }, duration);
                }
                
                // Limitar cantidad de notificaciones
                this.limitNotifications();
                
                // Agregar al estado
                AppState.ui.notifications.push({
                    id: Date.now(),
                    element: notification,
                    title,
                    message,
                    type,
                    timestamp: new Date()
                });
            }

            // Ocultar notificación
            hideNotification(notification) {
                if (!notification) return;
                
                notification.classList.add('hiding');
                
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                    
                    // Eliminar del estado
                    const index = AppState.ui.notifications.findIndex(n => n.element === notification);
                    if (index !== -1) {
                        AppState.ui.notifications.splice(index, 1);
                    }
                }, 300);
            }

            // Limitar cantidad de notificaciones
            limitNotifications() {
                const notificationContainer = document.getElementById('notificationContainer');
                if (!notificationContainer) return;
                
                const notifications = notificationContainer.children;
                if (notifications.length > CONFIG.MAX_NOTIFICATIONS) {
                    // Eliminar la notificación más antigua
                    const oldestNotification = notifications[0];
                    this.hideNotification(oldestNotification);
                }
            }

            // ============================================
            // SISTEMA DE RELOJ
            // ============================================

            // Inicializar reloj
            initClock() {
                this.updateClock();
                setInterval(() => this.updateClock(), 1000);
            }

            // Actualizar reloj
            updateClock() {
                const now = new Date();
                
                // Actualizar hora
                const timeElement = document.getElementById('currentTime');
                if (timeElement) {
                    timeElement.textContent = now.toLocaleTimeString('es-CR', { 
                        hour: '2-digit', 
                        minute: '2-digit',
                        second: '2-digit',
                        hour12: false
                    });
                }
                
                // Actualizar saludo
                const greetingElement = document.getElementById('greeting');
                if (greetingElement) {
                    const hour = now.getHours();
                    let greeting = '';
                    
                    if (hour < 12) {
                        greeting = '¡Buenos días!';
                    } else if (hour < 19) {
                        greeting = '¡Buenas tardes!';
                    } else {
                        greeting = '¡Buenas noches!';
                    }
                    
                    greetingElement.textContent = greeting;
                }
            }

            // ============================================
            // UTILIDADES
            // ============================================

            // Formatear tiempo relativo
            formatRelativeTime(date) {
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);
                
                if (diffMins < 1) return 'justo ahora';
                if (diffMins < 60) return `hace ${diffMins} minuto${diffMins !== 1 ? 's' : ''}`;
                if (diffHours < 24) return `hace ${diffHours} hora${diffHours !== 1 ? 's' : ''}`;
                if (diffDays < 7) return `hace ${diffDays} día${diffDays !== 1 ? 's' : ''}`;
                if (diffDays < 30) return `hace ${Math.floor(diffDays / 7)} semana${Math.floor(diffDays / 7) !== 1 ? 's' : ''}`;
                
                return `el ${date.toLocaleDateString('es-CR')}`;
            }

            // Obtener etiqueta de prioridad
            getPriorityLabel(priority) {
                const labels = {
                    'high': 'Alta',
                    'medium': 'Media',
                    'low': 'Baja'
                };
                return labels[priority] || priority;
            }

            // Obtener etiqueta de estado
            getStatusLabel(status) {
                const labels = {
                    'pending': 'Pendiente',
                    'inprogress': 'En Proceso',
                    'completed': 'Completada'
                };
                return labels[status] || status;
            }

            // Obtener etiqueta de tipo de evento
            getEventTypeLabel(type) {
                const labels = {
                    'meeting': 'Reunión',
                    'report': 'Informe',
                    'teletrabajo': 'Teletrabajo',
                    'oficina': 'Oficina',
                    'capacitacion': 'Capacitación',
                    'other': 'Otro'
                };
                return labels[type] || type;
            }

            // ============================================
            // INICIALIZACIÓN DE EVENT LISTENERS
            // ============================================

            // Inicializar event listeners
            initEventListeners() {
                // Modal de tarea
                document.getElementById('saveTaskBtn')?.addEventListener('click', () => {
                    this.saveTask();
                });
                
                document.getElementById('cancelTaskBtn')?.addEventListener('click', () => {
                    this.closeTaskModal();
                });
                
                document.getElementById('closeTaskModal')?.addEventListener('click', () => {
                    this.closeTaskModal();
                });
                
                // Modal de evento
                document.getElementById('saveEventBtn')?.addEventListener('click', () => {
                    this.saveEvent();
                });
                
                document.getElementById('cancelEventBtn')?.addEventListener('click', () => {
                    this.closeEventModal();
                });
                
                document.getElementById('closeEventModal')?.addEventListener('click', () => {
                    this.closeEventModal();
                });
                
                // Modal de enlace
                document.getElementById('saveLinkBtn')?.addEventListener('click', () => {
                    this.saveLinkFromModal();
                });
                
                document.getElementById('cancelLinkBtn')?.addEventListener('click', () => {
                    this.closeLinkModal();
                });
                
                document.getElementById('closeLinkModal')?.addEventListener('click', () => {
                    this.closeLinkModal();
                });
                
                // Modal de informe
                document.getElementById('saveReportBtn')?.addEventListener('click', () => {
                    this.generateReport();
                });
                
                document.getElementById('cancelReportBtn')?.addEventListener('click', () => {
                    this.closeReportModal();
                });
                
                document.getElementById('closeReportModal')?.addEventListener('click', () => {
                    this.closeReportModal();
                });
                
                document.getElementById('generateReportModalBtn')?.addEventListener('click', () => {
                    this.generateReportWithAI();
                });
                
                // Cerrar modales al hacer clic fuera
                document.querySelectorAll('.modal-overlay').forEach(modal => {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            if (modal.id === 'taskModal') this.closeTaskModal();
                            if (modal.id === 'eventModal') this.closeEventModal();
                            if (modal.id === 'linkModal') this.closeLinkModal();
                            if (modal.id === 'reportModal') this.closeReportModal();
                        }
                    });
                });
                
                // Cerrar modales con Escape
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        if (AppState.ui.modals.task) this.closeTaskModal();
                        if (AppState.ui.modals.event) this.closeEventModal();
                        if (AppState.ui.modals.link) this.closeLinkModal();
                        if (AppState.ui.modals.report) this.closeReportModal();
                    }
                    
                    // Atajos de teclado
                    if (e.ctrlKey || e.metaKey) {
                        switch(e.key.toLowerCase()) {
                            case 'n':
                                e.preventDefault();
                                if (AppState.currentPage === 'tasks') {
                                    this.openTaskModal();
                                } else if (AppState.currentPage === 'calendar') {
                                    this.openEventModal();
                                }
                                break;
                            case 's':
                                e.preventDefault();
                                this.saveData();
                                break;
                            case 'e':
                                e.preventDefault();
                                if (AppState.currentPage === 'links') {
                                    this.openLinkModal();
                                }
                                break;
                        }
                    }
                });
                
                // Perfil de usuario
                document.getElementById('userProfile')?.addEventListener('click', () => {
                    this.navigateTo('settings');
                });
            }

            // Generar informe
            generateReport() {
                this.showNotification('Generando informe', 'El informe se está generando...', 'info');
                
                // Simular generación de informe
                setTimeout(() => {
                    this.showNotification('Informe generado', 'El informe ha sido generado correctamente', 'success');
                    this.closeReportModal();
                }, 2000);
            }

            // Generar informe con IA
            generateReportWithAI() {
                this.showNotification('Generando con IA', 'La IA está generando el informe...', 'info');
                
                // Simular generación con IA
                setTimeout(() => {
                    this.showNotification('IA completada', 'La IA ha generado el informe base', 'success');
                }, 3000);
            }
        }

        // ============================================
        // INICIALIZACIÓN DE LA APLICACIÓN
        // ============================================

        // Crear instancia global del sistema
        window.mepSystem = new MEPSystem();

        // Inicializar cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', () => {
            // Verificar si ya se inicializó
            if (!window.mepSystemInitialized) {
                window.mepSystemInitialized = true;
                
                // Pequeño retraso para asegurar que todo esté cargado
                setTimeout(() => {
                    // El sistema ya se inicializó en la creación de la instancia
                    console.log('✅ Aplicación MEP 4.0 lista');
                }, 100);
            }
        });

        // Manejar errores no capturados
        window.addEventListener('error', (event) => {
            console.error('❌ Error no capturado:', event.error);
            
            // Mostrar notificación de error
            if (window.mepSystem) {
                window.mepSystem.showNotification(
                    'Error del sistema',
                    'Ha ocurrido un error inesperado. Algunas funciones podrían no estar disponibles.',
                    'error'
                );
            }
        });

        // Prevenir cierre con cambios no guardados
        window.addEventListener('beforeunload', (event) => {
            // En una implementación real, aquí se verificaría si hay cambios no guardados
            // Por ahora, solo mostramos un mensaje genérico
            // event.preventDefault();
            // event.returnValue = '¿Está seguro de que desea salir? Los cambios podrían no guardarse.';
        });

        // Exportar funciones globales para acceso desde HTML
        window.showNotification = function(title, message, type = 'info') {
            if (window.mepSystem) {
                window.mepSystem.showNotification(title, message, type);
            }
        };

        window.copyToClipboard = function(text) {
            if (window.mepSystem) {
                window.mepSystem.copyToClipboard(text);
            } else {
                navigator.clipboard.writeText(text).then(() => {
                    alert('Copiado al portapapeles');
                });
            }
        };
    </script>
</body>
</html>
